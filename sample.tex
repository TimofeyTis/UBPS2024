%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Sample document for preparing papers for  "Upravlenie bolshimi sistemami"
%%  charset=windows-1251
%%  The sample is based on the analogous sample of "Avtomatika i Telemekhanika".
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[11pt]{ubs}
%%
%% для просмотра "as is" необходим набор русских шрифтов А. Лебедева
%% http://tex.imm.uran.ru/texserver/fonts/pscyr/pscyr4c/
%%

%_______________________________________________________________________________________________________
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{diagbox}
\usepackage{multirow}
\usepackage{empheq}
\usepackage{colortbl}
\usepackage{xcolor} % Для задания цветов
\DeclareMathOperator{\perprob}{P}
\DeclareMathOperator{\state}{\mathcal{S}}
\DeclareMathOperator{\action}{\mathcal{A}}

\definecolor{sfugrey}{RGB}{56,79,123}
%_______________________________________________________________________________________________________

\issue{XX}% Выпуск Сборника - проставляется в процессе верстки
\rubric{Программы и системы моделирования объектов, средств и систем управления}%  Рубрика Сборника - может быть скорректирована редактором
%
% Имеющиеся рубрики (последнюю информацию см. на сайте ubs.mtas.ru):
%
%    Системный анализ
%    Математическая теория управления
%    Анализ и синтез систем управления
%    Информационные технологии в управлении
%    Управление в социально-экономических системах
%    Управление в медико-биологических и экологических системах
%    Управление техническими системами и технологическими процессами
%    Управление подвижными объектами и навигация
%    Технические и программные средства управления
%    Надежность и диагностика средств и систем управления
%    Программы и системы моделирования объектов, средств и систем управления

% В соответствии с требованиями ВАК коды УДК и ББК обязательны. Проставляются автором. Могут быть скорректированы редактором
\udk{УДК ...} % Коды УДК можно найти на сайте https://classinform.ru/udk.html
\bbk{ББК ...} % Коды ББК можно найти на сайте https://classinform.ru/bbk.html

\title{Название статьи}% Название статьи
\engtitle{Article Title} % В соответствии с требованиями ВАК обязательно указывается название статьи на английском языке.

% Ссылка на грант и прочие благодарности. Оставьте команду \footnote и просто измените ее аргумент.
% Если ссылка не нужна, просто удалите следующую строку.
\thanks{\footnote{Работа поддержана Красноярским математическим центром, финансируемым Минобрнауки РФ (Соглашение 075-02-2024-1429).}}

% Список авторов должен вводиться в представленной форме. Авторы вводятся в алфавитном порядке.
% Сначала указывается Фамилия И.О., затем следует подстрочная ссылка (footnote) с полным именем,
% ученой степенью, должностью и контактной информацией (телефоном или e-mail-ом) автора,
% затем, с новой строки курсивом - организация, в которой работает автор.
% Если несколько подряд идущих авторов работают в одной организации, допускается перечислять их в одной строке,
% после которой идет строка с названием организации (см. пример ниже).
%
\authors{
%
\textbf{Тисленко~Т.И.}\footnote{Тисленко Тимофей Иванович, \emph{(}timtisko@mail.ru\emph{)}.},
\textbf{Семенова~Д.В.}\footnote{Семенова Дарья Владиславовна,\,д.ф.-м.н.,\,доцент\,\hbox{\makebox(25ex,1ex){\;\;\;\emph{(}DVSemenova@sfu-kras.ru\emph{).}
}
} }\\
\textit{\emph{(}Сибирский федеральный университет, г.~Красноярск\emph{)}}
%
}
%
\engauthors{% % В соответствии с требованиями ВАК обязательно указывается информация об авторах на английском языке.
\textbf{Alexander Ivanov}, Institute of Control Sciences of RAS,
Moscow, Cand.Sc., assistant professor (aaivanov@mail.ru). \\
\textbf{Boris Petrov}, Institute of Control Sciences of RAS, Moscow,
Doctor of Science, professor (Moscow, Profsoyuznaya st., 65,
(495)000-00-00). \\
\textbf{Vikor Sidorov}, Moscow Institute of Physics and Technology,
Moscow, student (viktor.sidorov@mipt.ru). }

\abstract{%
В статье представлены результаты разработки программного комплекса MARLIN24, предназначенного для адаптивного управления светофорными \linebreak объектами. 
Структура комплекса включает  модуль адаптивного управления светофорными объектами, модуль симуляции движения транспорта и  модуль валидации. 
Математическая модель процесса управления светофорными \linebreak объектами --- управляемый марковский процесс с конечным числом действий и \linebreak  состояний. Задача поиска эффективного управления в целях  уменьшения суммарного времени нахождения  транспортных средств на детектируемых участках дорожной сети  сводится к задаче мультиагентного обучения с подкреплением (Multiagent Reinforcement Learning for Integrated Network, MARLIN).  Для поиска решения задачи MARLIN был построен алгоритм \linebreak $Q$-обучения.  
Структура комплекса программных средств также включает модуль  микросимуляции транспортных потоков  <<разумный водитель>> (Intelligent Driver Model, IDM).
Для имитации информации о реальной дорожной обстановке, поступающей в виде показаний оптического датчика,  в модуле валидации используются многомерные распределения, полученные с помощью применения копул Маршала-Олкина к маргинальным эмпирических распределениям для временных отметок  срабатывания оптического датчика.
Для построения маргинальных распределений использовались данные об интенсивности движения через детектируемые участки дорожной сети в период с 2019 по 2020 год.
}

% В соответствии с требованиями ВАК обязательно приводится расширенная аннотация на английском языке.
% Объем расширенной английской аннотации -- 150-200 слов.
% Английский текст проверяется редактором на предмет грамотности и соответствия русскому тексту и может быть изменен без согласования с авторами статьи.
\engabstract{%
150--200 words. Describes the standards of articles' formatting for "Large systems control" papers collection. Provides the examples for typical elements of an article. 150--200 words. Describes the standards of articles' formatting for "Large systems control" papers collection. Provides the examples for typical elements of an article. 150--200 words. Describes the standards of articles' formatting for "Large systems control" papers collection. Provides the examples for typical elements of an article. 150--200 words. Describes the standards of articles' formatting for "Large systems control" papers collection. Provides the examples for typical elements of an article.\newpage
}

% Обязательно указывается от трёх до шести ключевых слов
\keywords{имитационное моделирование транспортных потоков, модель IDM, модель MOBIL, копулы Маршалла-Олкина, машинное обучение с подкреплением}

% В соответствии с требованиями ВАК обязательно приводится перевод ключевых слов на английский язык.
\engkeywords{large systems control, electronic scientific
publication, article formatting template}

\presented{...}% Член редколлегии, представляющий статью к публикации, заполняется редактором
\received{...}% Дата получения материала редакционной коллегией, заполняется  редактором
\published{...}% Дата опубликования статьи, заполняется редактором

\begin{document}

\maketitle

\section{Введение}
Одной из задач решаемых в ходе реализации транспортной стратегии России на 2035 год \cite{transp_strat} является увеличение пропускной способности и увеличение скоростных параметров дорожной инфраструктуры до уровня лучших мировых достижений.
Разработка и внедрение программных и математических инструментов для моделирования транспортных потоков и управления
светофорными объектами для наиболее нагруженных участков дорожной сети учитывает общесоциальные целевые ориентиры транспортной стратегии: подвижность населения, снижение аварийности, рисков и угроз безопасности по видам транспорта, снижение доли транспорта в загрязнении окружающей среды. Одним из подходов к решению поставленных задач является использование продвинутых систем, управляющих светофорными объектами.



Системы, управляющие светофорными объектами, подразделяют на те, которые корректируют сигналы светофоров в реальном времени и реагируют на текущую дорожную обстановку --- АСУД (адаптивные системы управления дорожным движением) и неадаптивные --- те, которые работают согласно фиксированному плану управления.
Неадаптивные системы светофоров  переключают фазы светофоров через заранее заданное фиксированное время.
В таблице \ref{tab:adapt} представлены наиболее известные АСУД.

\begin{table}[h!]
  \caption{Модели адаптивных систем светофоров}
  \label{tab:adapt}
  \centering
  \scalebox{0.63}{
    \begin{tabular}{|c||c|c|c|c|c|c|}\hline
      \textbf{Критерий} & \textbf{UTCS-1}                       & \textbf{SCOOT}                          & \textbf{OPAC}                                                 & \textbf{MARLIN} & \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}\textbf{АСУДД} \\\textbf{<<Микро>>}\rule[-0.5em]{0em}{1.2em}} \\ \hline
      город             & Вашингтон                             & Лондон                                  & \parbox{0.2\textwidth}{\centering \rule{0em}{1.2em}Арлингтон,                                                                                    \\Тускон\rule[-0.5em]{0em}{1.2em}} & Торонто & Красноярск \\ \hline
      \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}временной                                                                                                                                                                                            \\период} &1970е&1995&1983,1989& 2010 & 1993\\ \hline
      \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}длительность                                                                                                                                                                                         \\фаз\rule[-0.5em]{0em}{1.2em}} & \multicolumn{2}{c|}{фиксированная}  & \multicolumn{3}{c|}{переменная}  \\ \hline
      оптимизация       & офлайн                                & \multicolumn{4}{c|}{онлайн}                                                                                                                                                                \\ \hline
      предсказание      & нет                                   & \multicolumn{2}{c|}{есть}               & нет                                                           & есть                                                                             \\ \hline
      устройство        & \multicolumn{2}{c|}{централизованная} & \multicolumn{3}{c|}{децентрализованная}                                                                                                                                                    \\ \hline
      \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}основные                                                                                                                                                                                             \\ограничения\rule[-0.5em]{0em}{1.2em}}   & \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}постоянный\\сбор данных} & \parbox{0.15\textwidth}{\centering \rule{0em}{1.2em}сенсоры \\далеко} & \parbox{0.2\textwidth}{\centering \rule{0em}{1.2em}только для\\  8 фаз}& \parbox{0.25\textwidth}{\centering <<ПРОКЛЯТИЕ\\РАЗМЕРНОСТИ>>} &  \parbox{0.2\textwidth}{\centering \rule{0em}{1.2em}находится \\в разработке} \\ \hline
      авторы &&&&&\\\hline
    \end{tabular}
  }
\end{table}

% В современных реалиях многие зарубежные компании одна за другой уходят с российского рынка, что делает использование их программных продуктов сложным и небезопасным. Об остановке деятельности в РФ уже известили Microsoft, Oracle, Autodesk, SAP,  Poster и многие другие крупные издатели профессионального программного обеспечения. Поэтому разработка отечественного программного обеспечения является актуальной.

% Автоматизированная Система Управления Дорожным Движением (АСУДД <<Микро>>) \cite{ASUDD} --- наиболее широко используемая в России система, которая успешно применена для следующих регионов:
% Иркутск; Красноярский край; Иркутская; Красноярск; Белгород; Ангарск; Воронеж; Хабаровск; Московская область.
% АСУДД <<Микро>> является децентрализованной системой и поддерживает до шести GPRS-серверов, позволяющих подключить 250 перекрестков.
% Отечественные оптические детекторы серии <<Инфопро>>, используемые в АСУДД <<Микро>>, предназначены для сбора статистических данных о транспортном потоке и данных реального времени для актуального управления и работают на расстоянии до 100 метров. По дальности распознавания данные датчики не уступают их бельгийскому аналогу TrafiCam. В данный момент основным недостатком рассматриваемой системы является тот факт, что реализация адаптивных алгоритмов находится в разработке.


В последние годы возрос интерес к теории мультиагентного программирования, в частности, в текущей работе исследуется модель  сети  управляемых светофоров. В данной модели целью управления является уменьшение  времени проезда транспортных средств через выбранные участки дорожной сети. 
Как альтернатива к применяемым на практике АСУД, в работе  предложен метод адаптивного управления, использующий  мультиагентное обучение с подкреплением (Multiagent Reinforcement Learning for Integrated Network, MARLIN)\cite{MARL}, основанные на марковских процессах принятия решений, которые могут и не оперировать интенсивностью проезда через поперечное сечение дороги.



Во {введении }  дается краткий обзор наиболее известных систем адаптивного управления светофорными объектами. Приводятся особенности реализации.


В {параграфе \ref{par:MARL_description}} приведено описание задачи машинного обучения с подкреплением для одного агента.
Агент (светофорный объект) не располагает ресурсами и решает задачу целесообразности активации той или иной светофорной фазы. Обозначим множество всех действий агента символом $\action$. Среда --- детектируемый перекресток с  оптическими датчиками, которые распознают машины на отрезках дорог за сто метров до стоп-линий. Состояние среды отражает активность фазы светофорных объектов и время, которое машины находятся в детектируемой зоне. Обозначим множество всех состояний среды символом $\state$.
В качестве математической модели светофорного объекта в работе рассматривается управляемый марковский процесс с конечным числом действий и  состояний $\left\langle  \state, \action, \mathbb{P}, r \right\rangle.$
Проблема управления 
светофорными объектами сводится к задаче мультиагентного обучения с подкреплением (Multiagent Reinforcement Learning).

В {параграфе \ref{par:MARL_many_description}} приведено описание задачи машинного обучения с подкреплением для нескольких агентов.
Введены основные определения и обозначения  для задачи обучения нескольких агентов. 
Задача поиска управления одного агента сведена к задаче машинного обучения нескольких агентов. \newpage

В {параграфе \ref{par:MARL_solution}} приведено решение задачи машинного обучения с подкреплением для нескольких агентов.
Приведены критерий оптимального управления Вальда-Беллмана в предложении \ref{prep:kropt}, итерационная запись для функции оценки эффективности управления $V,$ а также приведено предложение \ref{prep:search} о существовании и единственности оптимального решения.
В параграфе \ref{par:MARL_solution} выведены формулы для поиска оптимального решения (\ref{Voptsolve}) и (\ref{argoptsolve}).



В {параграфах \ref{par:MARLIN24_sim}, \ref{par:MARLIN24_val}, \ref{par:MARLIN24_comp}} приведено описание  комплекса программных средств MARLIN24.
Для исследования задачи управления светофорными объектами был разработан комплекс программных средств MARLIN24 на языке Python3.
Структура комплекса программных средств MARLIN24 приведена на рисунке~\ref{fig:structure_MARLIN24}.
\begin{figure}[tbph]
  \centering
  \includegraphics[width=0.95\textwidth]{structure}
  \caption{Структура комплекса программных средств MARLIN24}\label{fig:structure_MARLIN24}
\end{figure}


В рамках вычислительных экспериментов  в \textbf{параграфе \ref{par:computation}} были построены кривые обучения функции оценки эффективности управления, а также дана интерпретация полученному оптимальному управлению.






\section{Описание задачи для одного агента}
\label{par:MARL_description}


Как правило, обучение с подкреплением используется для одного агента в среде, чтобы максимизировать его долгосрочную награду. В работе исследуется модель обучения с подкреплением нескольких агентов (светофорных объектов) в стохастической среде. Обучение с подкреплением сводится к оптимальному сопоставлению агентом действия $a$ состоянию среды $s$. Предложенная математическая модель процесса выбора фазы светофора учитывает текущее расположение светофоров и их загрузку и позволяет сформулировать оптимизационные задачи, целью которых является минимизация задержки движения автомобилей. Отметим, что структура мультиагентной системы обеспечивает наиболее эффективное распараллеливание всей задачи на подзадачи.

Введём следующие обозначения: $ \state$ --- дискретное пространство состояний, $ \action$ --- дискретное пространство действий агента, $\delta \colon \state\to \action$ --- управление сменой фаз светофора. Фазы светофора меняются последовательно. Полагаем, что множество $ \state$ есть кольцо классов вычетов по модулю $n$ --- $\mathbb{Z}_n = \left\langle \mathbb{Z}, +, \cdot\right\rangle$, где $| \state| = n$ --- количество классов $\mathbb{Z}_n$.


Характеристика кольца вычетов $\mathbb{Z}_n$ равна $n$ и в данной модели отражает число смен фазы светофора до её возвращения к начальному значению, следовательно, число действий $\left|\action\right|$ до возвращения в начальное состояние светофора равно $n$.

Если агент находится в состоянии $s$, то при выборе действия $a = \delta(s)$ новое состояние $s'$ определяется формулой
{
\abovedisplayskip=0pt plus 0pt
\begin{equation}
  s'=(a\oplus s) = (a+s)\;\mathrm{mod}\;{\left\lvert\state \right\rvert}.
  \label{eq:newstate}
\end{equation}}




Приведем рассуждения, исходя из которых считается функция вознаграждения.
Для каждой полосы определено число машин  на отрезке дороги, начинающемся с детектора и заканчивающемся стоп-линией перекрестка.
Пусть  $r:  \state \times \action \mapsto \mathbb{R}$ --- функция вознаграждения агента при изменении наблюдаемого состояния $s_t$ при действии $a_t=\delta(s)$. 
В момент времени $t$ значение функции $r(s_t, a_t)=R_t$  определяется для следующей активной полосы и пропорционально времени, затраченному всеми машинами на преодоление детектируемых участков дороги.

Элементы матрицы переходов между состояниями $\mathbb{P}$ определяются вероятностями вида  $p(s' \bigm| s,a), $ где $s$ --- текущее состояние среды, $a$ --- текущее действие среды,  $s'$ --- следующее состояние среды и определяется по формуле (\ref{eq:newstate}). 
Состояние $s'$ всецело определяется текущим состоянием $s$ и выбранным действием $a.$

Опишем поведение агентов с помощью марковского процесса принятия решений $\left\langle  \state, \action, \mathbb{P}, r \right\rangle$ \cite{GASNIKOV}.

Процесс принятия решений для агента будет выглядеть следующим образом. В момент времени $t$ агент наблюдает состояние среды  $s_t\in\state$ и выбирает действие $a_t \in\action$. Среда отвечает генерацией награды $R_t$ и переходит в следующее состояние
$s_{t+1}=s'$ с вероятностью $p(s' \bigm| s_t, a_t)$.

  {
    Функция оценки эффективности применяемого управления $\delta= \{a_t, 0\leq t<\infty\}$ получается как кумулятивная функция:
    \abovedisplayskip = -3.5em
    \begin{equation}\label{VALUE}
      \begin{split}
        V( \left\{s_t, \delta_t\right\}) & = \lim\limits_{T\to\infty}V( {\cal T})  = \sum_{t=0}^{\infty}\gamma^t r\left( s_{t+1} \bigm| s_t,\delta_t\right) = \\
                                         & = \sum_{t=0}^{\infty}\gamma^t r\left( s_t,\delta_t\right)
        = \lim\limits_{T\to\infty}\mathbb{E}_{{\cal T}} \sum_{t=0}^{T}\gamma^t R_t,
      \end{split}
    \end{equation}
  }\noindent
где  величина $\gamma$, $0 < \gamma < 1$, называется коэффициентом переоценки и показывает во сколько раз уменьшается отложенное вознаграждение за один временной шаг \cite{Ivanov}. 
Переоценка задает приоритет получения награды в ближайшее время перед получением той же награды через некоторое время. Математически смысл условия $0 < \gamma < 1$ состоит в том, 
чтобы гарантировать ограниченность функционала $V.$
Под отложенным до момента времени $t$ вознаграждением принято понимать число $\gamma^t r_t.$ Далее предел в выражении (\ref{VALUE}) будем опускать.
%  Предпочтительным управлением  $\delta$ будет то, значение целевой функции $V(\delta)$ для которого будет больше. 


Формальная постановка  задачи вычисления оценки эффективности управления светофорным объектом представлена ниже.
\begin{center}
  \begin{tabular}{rl}
    {\sf Дано}:
     &
    \parbox[t]{0.84\textwidth}{марковский процесс принятия решения $\left\langle  \state, \action, \mathbb{P}, r \right\rangle$ для  управления светофорным объектом, активная  в начальный момент времени фаза светофорного объекта $s_0$.}
    \\
    {\sf  Найти}:
     &
    \parbox[t]{0.84\textwidth}{
    управление  светофорного  объекта $\delta^*=\{ a^*_t\}_{0\leq t<\infty}$,\;\;\;\;  которое  доставит максимум функции оценки его\;\;\;\;\;\;\;\;  эффективности (\ref{VALUE}).
    }
  \end{tabular}
\end{center}


\section{Описание задачи для нескольких агентов}
\label{par:MARL_many_description}




Расширим  задачу  на сеть из $K$ светофорных объектов. Утверждения сформулированные выше   справедливы для $K$ агентов. Далее для удобства записи будем использовать множество из двух агентов.   
Имеем множество из двух агентов, для каждого из которых описаны множество состояний $ \state^0, \state^1$ и множество решений $\action^0, \action^1$. 
Обозначим $\textbf{s}_t = \{s_t^1, s_t^2\} \in \state^0\times \state^1$ как  совокупное состояние среды в момент времени $t$,    $\textbf{a}_t = \{a_t^0, a_t^1\} \in \action^0\times \action^1$ как совокупное управление в момент времени $t$.

Отметим, что смена фазы любым агентом приводит к изменению общего состояния среды $\textbf{s}$.
\begin{example}
  В таблице \ref{table:raspred2} представлен пример распределения условных вероятностей перехода из состояния $\textbf{s}$ в состояние $\textbf{s}'$ с учетом выбора действия $\textbf{a}$.
 
  \begin{table}[tbh]
    \centering
    \caption{Распределение $p(\textbf{s}' \bigm| \textbf{s}, \textbf{a})$ }
    \label{table:raspred2}
    \scalebox{0.63}{
      \begin{tabular}{|*6{c|}}
        \hline
        $\textbf{a}$                        & \diagbox[width=3em, height=3em]{\hspace{0.5em}$\textbf{s}$}{\hspace{2ex}\raisebox{-0.6em}{$\textbf{s}'$}} & $\textbf{s}^{(0)}$ & $\textbf{s}^{(1)}$ & $\textbf{s}^{(2)}$ & $\textbf{s}^{(3)}$ \\
        \hline\hline
        \multirow{4}{*}{$\textbf{a}^{(0)}$} & $\textbf{s}^{(0)}$                                                                                        & 1                  & 0                  & 0                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(1)}$                                                                                        & 0                  & 1                  & 0                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(2)}$                                                                                        & 0                  & 0                  & 1                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(3)}$                                                                                        & 0                  & 0                  & 0                  & 1                  \\
        \hline\hline
        \multirow{4}{*}{$\textbf{a}^{(1)}$} & $\textbf{s}^{(0)}$                                                                                        & 0                  & 1                  & 0                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(1)}$                                                                                        & 0                  & 0                  & 1                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(2)}$                                                                                        & 0                  & 0                  & 0                  & 1                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(3)}$                                                                                        & 1                  & 0                  & 0                  & 0                  \\
        \hline
      \end{tabular}
      \begin{tabular}{|*6{c|}}
        \hline
        $\textbf{a}$                        & \diagbox[width=3em, height=3em]{\hspace{0.5em}$\textbf{s}$}{\hspace{2ex}\raisebox{-0.6em}{$\textbf{s}'$}} & $\textbf{s}^{(0)}$ & $\textbf{s}^{(1)}$ & $\textbf{s}^{(2)}$ & $\textbf{s}^{(3)}$ \\
        \hline
        \hline
        \multirow{4}{*}{$\textbf{a}^{(2)}$} & $\textbf{s}^{(0)}$                                                                                        & 0                  & 0                  & 1                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(1)}$                                                                                        & 0                  & 0                  & 0                  & 1                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(2)}$                                                                                        & 1                  & 0                  & 0                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(3)}$                                                                                        & 0                  & 1                  & 0                  & 0                  \\
        \hline\hline
        \multirow{4}{*}{$\textbf{a}^{(3)}$} & $\textbf{s}^{(0)}$                                                                                        & 0                  & 0                  & 0                  & 1                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(1)}$                                                                                        & 1                  & 0                  & 0                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(2)}$                                                                                        & 0                  & 1                  & 0                  & 0                  \\
        \cline{2-6}
                                            & $\textbf{s}^{(3)}$                                                                                        & 0                  & 0                  & 1                  & 0                  \\
        \hline
      \end{tabular} }
  \end{table}
  \noindent
  Также переходы между состояниями, соответствующие рассматриваемой цепи, можно графически изобразить в виде стохастического графа на рисунке~\ref{fig:stohgraph22}, где используется нумерация в двоичной системе счисления согласно  формуле (\ref{zeroone}).

  \begin{figure}[tbph]
    \centering
    \includegraphics[width =0.55\textwidth]{stog_graph_4state}
    \caption{Стохастический граф управляемого процесса смены фаз. Здесь $s_{l}$ отражает совокупное состояние светофоров $l$ ($l = $0b00, 0b01, 0b10, 0b11).  При действии $\textbf{a}^{(m)}$  ($m = $0b00, 0b01, 0b10, 0b11) процесс перейдет в состояние $n = l\oplus m$, c вероятностью $p_{ln}$.}
    \label{fig:stohgraph22}
  \end{figure}

\noindent
\rule{0.95\textwidth}{0em}
\end{example}



Для случая, когда рассматривается сеть светофорных объектов с двумя состояниями, следующую фазу светофора можно найти с помощью операции <<исключающего или>>:
\begin{equation}\label{zeroone}
  \textbf{s}'=\textbf{a} \oplus \textbf{s}.
\end{equation}

Введем обозначение  двоичного литерала из языка программирования  Python3.
Согласно ей, в записи перед номером ставится префикс $0b$ (binary). Например, число $2$ в двоичной записи будет представлено как  $0b10$.
В  случае для действия $\textbf{a}=2$ можно провести следующие рассуждения: с заменой системы счисления и сопоставлением вектору из $\action^0\times \action^1$. Действия $a^0 =1$ и $a^1 =0$  однозначно  задают совместное действие $\textbf{a} = \left(a^0,a^1\right) = 0b10$.


В момент времени $t$ функция наград $r(\textbf{s}_t,\textbf{a}_t)$ определяется как сумма функций наград каждого агента по отдельности $r(\textbf{s}_t,\textbf{a}_t) = r(s_t^0,a_t^0) + r(s_t^1,a_t^1),$ которые в свою очередь рассчитываются согласно формуле (\ref{VALUE}).
В таком случае функция оценки эффективности управления примет вид
\begin{equation}\label{VALUE3}
  \displaystyle V(\textbf{s}) =  \sum\limits_{t=0}^{\infty}\gamma^t r(\textbf{s}_t,\textbf{a}_t),
\end{equation}
где $0 \leq \gamma \leq 1$ --- коэффициент переоценки.

Управление фазами двух светофорных объектов находится как решение задачи обучения с подкреплением (Multiagent Reinforcement Learning for   Integrated Network, MARLIN) и формулируется следующим образом.
\begin{center}
  \begin{tabular}{rp{0.85\textwidth}}
    {\sf Дано}:
     &
    \parbox[t]{0.85\textwidth}{марковский процесс принятия решения
      $\left\langle  \state^0\times \state^1, \action^0\times \action^1, \mathbb{P}, r \right\rangle$ для управления дорожной сетью из двух светофорных объектов, активные  в начальный момент времени фазы $\textbf{s}_0$.}
    \\
    {\sf Найти}:
     &
    \parbox[t]{0.85\textwidth}{
    управление светофорными объектами  $\delta^*=\{ \textbf{a}^*_t\}_{0\leq t<\infty}$, которое доставит максимум функции оценки  эффективности  (\ref{VALUE3}). }
  \end{tabular}
\end{center}


%Требуется найти такое управление $\delta=\{\textbf{a}_t, 0\leq t<\infty\}$, которое доставляет максимум функции суммарных вознаграждений для двух агентов 
%\begin{equation}\label{VALUEfor2}
%\displaystyle V(\textbf{s}) =  \mathbb{E}\sum\limits_{t=0}^{\infty}\gamma^t r(\textbf{s}_t,\textbf{a}_t) \rightarrow \max\limits_{\delta},\textbf{s}_0 = \textbf{s},
%\end{equation}
\section{Решение задачи}
\label{par:MARL_solution}

Решение задачи поиска  оптимального совокупного управления светофорными объектами дорожной сети ищется методом динамического программирования согласно принципу оптимальности Вальда---Беллмана.

\begin{proposition}\label{prep:kropt}
  \cite{My2} В задаче управления фазами светофорного объекта уравнение Вальда---Беллмана имеет вид
  {
  \abovedisplayskip=-0.0em
  \belowdisplayskip=0em
  \begin{equation}\label{BELMAN}
    V^* = \max_{a \in \action} \sum_{s'\in \state} p(s'\bigm|s, a)(r(s, a)+\gamma V^*(s')).
  \end{equation}}
  %для управляемого марковского процесса с конечным числом действий и состояний в контексте  задачи (\ref{VALUE}).
\end{proposition}

Перепишем формулу (\ref{BELMAN}) в итерационной записи, называемой $Q$-обучение.
Функция суммарных вознаграждений при оптимальном управлении на шаге $t$ имеет вид
{\abovedisplayskip=0.5em
\belowdisplayskip=0.0em
\[
  V^*\left(\{\textbf{s}_{t'}, \delta \}_{t'=0}^{t'=t}\right)=\max\limits_{\textbf{a}\in{\cal \action}} Q_t(\textbf{s}_t, \textbf{a}),
\]}

{\abovedisplayskip=-0.5em
\belowdisplayskip=0.0em
\[
  Q_t(\textbf{s}_t, \textbf{a})  =    \sum\limits_{\textbf{s}_{t+}\in {\cal \state}} p(\textbf{s}_{t+1} \bigm|\textbf{s}_t,\textbf{a})\Bigl(r(\textbf{s}_{t+1} \bigm|\textbf{s}_t,\textbf{a})+\gamma \max\limits_{\textbf{a}' \in {\cal \action}}Q_{t-1}(\textbf{s}_{t-1},\textbf{a}') \Bigr).
\]
}

Для совместных действий и состояний итерационно заданная функция $Q_t$ имеет вид:
{
\abovedisplayskip=0.5em
\belowdisplayskip=0.0em
$$
  Q_t(\textbf{s},\textbf{a}) = \sum\limits_{\textbf{s}'} p(\textbf{s}'\bigm|\textbf{s}, \textbf{a})r(\textbf{s},\textbf{a}) + \gamma\sum\limits_{\textbf{s}'}p(\textbf{s}' \bigm| \textbf{s}, \textbf{a})
  V^*\left(\textbf{s}' \right).
$$}
\noindent
Условимся, что записи $Q_t(\textbf{s},a,a')$ и $ Q_t(\textbf{s},\textbf{a})$ тождественны.

Считаем, что нам известно состояние среды $s_{t+1}$ и оптимальное управление $a_{t+1} $ на шаге $t+1,$ соответствующий итерации ${\hat{t}},$ и условимся, что итерация $Q$ идет по индексу $\hat{t}$, тогда
{\abovedisplayskip=0.5em
\begin{equation}\label{eq:iteration_formula_Q}
  \begin{split}
    Q_{t}(\textbf{s},\textbf{a}) & =  \underbrace{p(s_{t+1}| s,a)\rule[-0.8em]{0em}{2em}}_{\alpha_{\hat{t}}} \Bigl( r_{t+1} + \gamma V^*(\textbf{s}_{t+1})\Bigr)  +                                                                         \\
                                 & + \underbrace{\sum\limits_{\textbf{s}' \in S/\textbf{s}_{t+1}} p(\textbf{s}'| \textbf{s},\textbf{a}) }_{1-\alpha_{\hat{t}}}\Bigl( r(\textbf{s}'| \textbf{s},\textbf{a}) + \gamma V(\textbf{s}') \Bigr) = \\
                                 & =\alpha_{\hat{t}}\Bigl( r_{\hat{t}} + \gamma\max\limits_{\textbf{s}'}Q_{\hat{t}}(\textbf{s}_{t+1},\textbf{s}')\Bigr)  + \Bigl(1- \alpha_{\hat{t}}\Bigr) Q_{\hat{t}}(\textbf{s},\textbf{a})   =           \\
                                 & =  Q_{\hat{t}+1}(\textbf{s},\textbf{a}).
  \end{split}
\end{equation}}

Сведем задачу поиска максимизирующего совместного действия агентов $k,j$ к случаю для одного агента, совершающего действие $\textbf{a}^{kj}$.  
Функция $Q$ для агента $k$ определяется как
\abovedisplayskip=0.5em
\belowdisplayskip=0.0em
\begin{equation*}
  \begin{split}
    Q_{\hat{t}}^k(\textbf{s},a^k) & = \sum\limits_{a^j \in \action^j} p(a^j \bigm| s, a^k) \Bigl(
    r(\textbf{s},\textbf{a}^{kj}) +                                                                                                                                                  \\
                                  & + \gamma\sum\limits_{\textbf{s}'}p\left(\textbf{s},\textbf{a}^{kj}\right)\max\limits_{\textbf{a}'}Q_{\hat{t}-1}(\textbf{s}',\textbf{a}') \Bigr).
  \end{split}
\end{equation*}

Оптимальное управление для фиксированного агента $k$ будем искать как решение задачи MARL в виде %\cite{}:
{
\abovedisplayskip=-0em
\belowdisplayskip=0em
\begin{equation}\label{eq:solfor2}
  {a}^k_{\hat{t}} = \arg\max\limits_{{a}^{k} \in  \action^k} Q^k_{\hat{t}}( \textbf{s}_{\hat{t}}, {a}^{k}).
\end{equation}
}
Вероятность $p(a^j \bigm| s, a^k)$ --- это вероятность того, что агент $j$ выберет действие $\textbf{a}^j$ с учётом текущего совместного состояния $\textbf{s}$ и выбранного агентом $k$ действия $\textbf{a}^k$.

Решение задачи поиска  оптимального совокупного управления светофорными объектами дорожной сети ищется, чтобы увеличить максимальное совокупное вознаграждение, определяемое функцией $Q$ по итерационной формуле (\ref{eq:iteration_formula_Q}),~(\ref{eq:solfor2}). 
Вероятность  $p\left(\textbf{s}'\bigm| \textbf{s},\textbf{a}^{kj}\right)$ для такого максимизирующего действия оценивается параметром $\alpha.$ 
Для каждого многомерного решения верны утверждения (\ref{prep:kropt}), (\ref{prep:search}), а также, они верны в случае нескольких координированных агентов.
Таким образом, задача совокупного управления несколькими агентами сводится к задаче управления одним агентом и  справедливо утверждение об единственности решения.

\begin{proposition}\label{prep:search}
  \cite{My3} Для задачи поиска оптимального управления светофорным объектом с любым количеством фаз
  % \begin{equation}%\label{VALUE}
  %V(s) = \mathbb{E}\sum_{t=0}^{\infty}\gamma^t r(s_t,\delta(s_t)) \rightarrow\max\limits_\delta, s_0 = s
  % \end{equation}
  справедливы следующие  утверждения
  \begin{itemize}[itemsep=-3pt]
    \item существует единственное точное решение;
    \item оценка точности приближенного  решения на $n$-ом шаге итерации
          {
          \belowdisplayskip=0em
          $$
            \rho(Q_n, Q_0) \leqslant \frac{\gamma ^n \rho(Q_1, Q_0)}{ 1 - \gamma},
          $$}
          где $Q_t \in \mathbb{R} _{\infty}^{| \action|+| \state|}$ --- вектора значений $Q(s, a)$ на шаге $t$,\\
          $\forall q,w \in \mathbb{R} _{\infty}^{| \action|+| \state|}$ определена функция
          $\rho(q, w) = \max\limits_{ 1\leqslant j \leqslant \left|A\right|+\left|S\right|} \left| {q}_j - {w}_j\right|;$ % --- метрика пространства  $\mathbb{R} _{\infty}^{| \action|+| \state|}$, определенная для $\forall q,w \in \mathbb{R} _{\infty}^{| \action|+| \state|};$
    \item приближенное решение находится согласно формулам
          \begin{equation}\label{Voptsolve}
            V ^*(s) = \max_{a\in  \action}  \lim _{t \to + \infty}Q_t(s, a),     \end{equation}
          \begin{equation}\label{argoptsolve}
            a_t(s) = \arg  \max_{a' \in  \action} Q_t(s, a').  \end{equation}



          %$\left\langle {\mathbb{R} _{\infty}^{| \action|+| \state|},\rho(\cdot, \cdot)} \right\rangle$ --- полное метрическое пространство c 
          % $\forall q, w \in \mathbb{R} _{\infty}^{| \action|+| \state|}$ 
          %метрикой $\rho(q, w) = \max\limits_{ 1\leqslant j \leqslant \left|A\right|+\left|S\right|} \left| {q}_j - {w}_j\right|,$ $\forall q, w \in \mathbb{R} _{\infty}^{| \action|+| \state|}.$


  \end{itemize}
  %Оценка точности приближенного  решения на $n$-ом шаге итерации имеет вид
  %  $$
  % \rho(Q_n(s, a),Q_0(s, a)) \leqslant \frac{\gamma ^n \rho(Q_1(s, a),Q_0(s, a))}{ 1 - \gamma}.
  % $$
\end{proposition}



\section{Модуль симуляции}
\label{par:MARLIN24_sim}

Согласно схеме на рисунке~\ref{fig:structure_MARLIN24}, в модуле симуляции  с помощью пакета osmnx из Open Street Map был импортирован мультиграф \textbf{map.osm}, задающий параметры и координаты  в координатной системе WGS84/UTM (World Geodetic System 1984/Universal Transverse Mercator).  
Далее, по графу строится дорожная сеть, строятся маршруты транспорта с использованием пакета networkx\cite{networkx}.
Поскольку построение маршрутов транспорта является весьма трудоемкой задачей,  то для ускорения инициализации модели используется   многопоточная реализация алгоритма построения маршрутов при помощи модуля  threading\cite{python-threading} (рис.~\ref{fig:structure_MARLIN24}).

При построении дорожной, сети вершинам присваивается уникальный номер osmid. Каждая вершина представляет узел (перекресток, регулируемый пешеходный переход) или место существенного изменения характеристик дороги.  Каждое ребро соответствует реальному участку дороги без перекрестков. 
В ребрах хранится информация о соединяемых ими вершинах, их координатах, длине дороги, количестве полос, названии улицы, а также других параметрах из табл. \ref{table:road_params_OSM}.

\begin{table}[h!]
  \caption{Импортируемые параметры дорог из OSM}\label{table:road_params_OSM}
  \scalebox{0.72}{
    \begin{tabular}{|l||l|l|}\hline
      \rule{0em}{1.5em}\textbf{Параметр} & \textbf{Принимаемые значения}                                                                       & \textbf{Описание} \hfill                                                                                                                             \\\hline
      lanes                              & int                                                                                                 & число полос.                                                                                                                                         \\\hline
      highway                            & \begin{tabular}[c]{@{}l@{}}residential\\ primary\\ secondary\\ terliary\\ unclassified\end{tabular} & \begin{tabular}[c]{@{}l@{}} внутри жилых зон,\\ федерального,\\ областного,\\ местного значения,\\ образующие соединительную сеть дорог\end{tabular} \\\hline
      lanes                              & str                                                                                                 & название улицы                                                                                                                                       \\\hline
      oneway                             & bool                                                                                                & дороги, которые проходят внутри жилых зон                                                                                                            \\\hline
      reversed                           & bool                                                                                                & \begin{tabular}[c]{@{}l@{}}направление движения дорог \end{tabular}                                                                                  \\\hline
      length                             & float                                                                                               & Длинна дороги.                                                                                                                                       \\\hline
    \end{tabular}}
\end{table}

Для вручную отмеченных светофорных объектов были построены  матрицы корреспонденции потоков дорожного трафика, отвечающие его за распределение по доступным направлениям, а также из конфигурационного файла {TrafficLightConfig.xml} была перенесена информация об активируемых фазах и активируемых направлениях светофорных объектов.

Модуль симуляции трафика на  вход получает конфигурационный файл  {VehicleConfig.xml}, в котором содержатся такие параметры как максимально разрешенная скорость, коэффициент торможения (покрытие дороги),  количество полос и остальные параметры, описанные в таблице~\ref{table:road_params_OSM}.

В модели IDM\cite{IDM} транспортные  средства рассматриваются как индивидуальные сущности,  обладающие своими характеристиками и поведением.
Рассматриваемая модель относится к классу моделей движения за лидером,  она основана на взаимодействии между автомобилями, где каждый водитель регулирует скорость своего автомобиля в зависимости от расстояния до впереди идущего автомобиля, его скоро\-сти и собственной скоро\-сти.
На рисунке \ref{fig:IDM_illustration} представлено взаимное расположение и характеристики текущего автомобиля, расположенного в $i$-ой  позиции, и $(i-1)$-го автомобиля, находящегося перед ним.
\begin{figure}[tbph]
  \centering
  \includegraphics[width = 0.5\textwidth]{sim_descr.pdf}
  \caption{Иллюстрация модели IDM}\label{fig:IDM_illustration}
\end{figure}

Система уравнений, описывающих текущую скорость  $i$-го автомобиля  и расстояние до $(i-1)$-го автомобиля в модели IDM в классических обозначениях имеет вид:
\begin{equation} \label{eq:IDM_sys}
  \left\{
  \begin{array}{l}
    \displaystyle   \frac{dv_i}{dt}=
    \underbrace{a_i\Biggl( 1-\left(\frac{v_i}{v_{0,i}}\right)^\delta\Biggr)}_{\displaystyle a_{\mathrm{free}}}-
    \underbrace{a_i\Biggl( \frac{s^*\left(v_i\Delta v_i\right)}{s_i}\Biggr)^2}_{\displaystyle a_{\mathrm{deceleration}}}, \\
    \displaystyle
    s^*\left(v_i, \Delta v_i\right)=s_{0,i}+v_iT_i+\frac{v_i\Delta v_i}{\sqrt{2a_ib_i}}.
  \end{array}\right.
\end{equation}

При имитационном моделировании для нахождения значений скоро\-сти и ускорения  будем пользоваться формулами, вытекающими из численного метода <<пристрелки>> {\cite{SHOOT}}:
\[
  \left\{
  \begin{array}{l}
    \displaystyle\frac{dv}{dt}(t) =  a_{\mathrm{free}}(t)+a_{\mathrm{deceleration}}(t),              \\
    \displaystyle v(t+\Delta t)    =  v(t) + \frac{dv}{dt}(t)\Delta t,                               \\
    \displaystyle x(t+\Delta t)    =  x(t)+v(t)\Delta t+ \frac{1}{2}  \frac{dv}{dt}(t) (\Delta t)^2, \\
    \displaystyle s(t+\Delta t)    =  x_i(t+\Delta t)- x(t+\Delta t)- {l}_i.
  \end{array}
  \right.
\]
Шаг  симуляции $dt$ выбирается как шаг по времени при численном решении системы (\ref{eq:IDM_sys}).

  {
    Существенным ограничением модели IDM является ее применимость только к однополосному движению.
    Одним из способов расширить ее применимость к многополосным дорожным сетям является введение алгоритмов, описывающих перестроение транспортных средств.
    В работе используется модель MOBIL (Microscopic Optimally Balanced Intersection Lanes).  Данная модель перестроения вместе с моделью IDM   была разработана  Дириком Гельфандом, Мартином Трейбером и Арнольдом Кухнем \cite{MOBIL} в 1999 году и предназначалась для анализа и улучшения эффективности движения автомобилей на перекрестках.
  }

В основе модели MOBIL лежит идея о том, что водители принимают решения о перестроении и изменении скорости движения из соображений проходимости и безопасности.
Конкретное изменение полосы движения, например с правой полосы движения на левую полосу, как показано на {рисунок~\ref{fig:MOBIL},} зависит, как правило, от двух следующих транспортных средств на текущей полосе движения и соответственно на целевой полосе движения.

\begin{figure}[tbph]
  \centering
  \includegraphics[width = 0.5\textwidth]{mobil.pdf}
  \caption{Модель смены полосы MOBIL}\label{fig:MOBIL}
\end{figure}



Стимул для перестроения есть, если после первого фиктивного  перестроения  с правой полосы $R$ на левую полосу $L$ сумма собственного  ускорения  согласно модели IDM и ускорения соседних транспортных средств выше на порог изменения $\delta$:
{
\abovedisplayskip=-0.0em
\belowdisplayskip=0em
$$
  R\to L \quad \left(\widetilde{a_i}-a_i \right) + p\left((\widetilde{a}_{i-1}-a_{i-1})  + (\widetilde{a_j}-a_j)  \right) \geqslant \delta,
$$ }
где  $p \in \left[ -\infty;\frac{1}{2}\right]\cup  \left[1; +\infty\right]$ ---  вручную задаваемый коэффициент вежливости.

Также следует учитывать, что при перестроении $i$ на соседнюю полосу транспортные средства $j$ и следующие за ним не должны двигаться с коэффициентом торможения меньше, чем $b_{\mathrm{safe}}.$ Поскольку в модели IDM скорости, а, следовательно, и ускорения связаны формулой   (\ref{eq:IDM_sys}) и изменяются последовательно от лидирующего транспортного средства к последующему, то описать такое замедление можно формулой:
$
  \widetilde{a_j} \geqslant -b_{\mathrm{safe}}.
$

\section{Модуль валидации}
\label{par:MARLIN24_val}

В модуле валидации  решается задача имитационного моделирования интенсивности движения транспортного потока.
Решение задачи моделирования зависимых распределений среднесуточных интенсивностей состоит из двух этапов: этапа предобработки и этапа имитационного моделирования.

В данной работе под интенсивностью транспортного потока будем понимать число автомобилей, проезжающих через поперечное сечение участка дорожной сети в единицу времени, а под среднесуточной интенсивностью --- усредненное количество машин по рабочим дням в течение года.
Ранее в работе \cite{OMSK} при описании интенсивности транспортного потока использовалась статистка, описывающая количество машин,
в работе  \cite{TOMSK}  использовалась величина временного интервала между проездом двух автомобилей через сечение участка дорожной сети.



Рассмотрим второй подход для введения в модель зависимых случайных величин.
В основе подхода лежит использование двупараметрической копулы Маршал\-ла-Олкина \cite{marshall1996copulas}  для  совместного распределения временных интервалов появления автомобилей.


Пусть случайная величина $X$ с функцией распределения $F(x)$ и   случайная величина $ Y$ с функцией распределения $G (y)$ описывают временной интервал между проездом двух автомобилей через сечение детектируемого участка на полосах 1 и 2 соответственно.
По теореме Скляра \cite{nelsen2006introduction} совместную функцию распределения можно представить копулой $C$
\begin{equation}\label{eq:Copula_H}
  H_{XY}(x,y)=C(F (x), G(y)), \qquad \forall x,y\in \mathbb{R}.
\end{equation}
\noindent



Далее   будем использовать двупараметрическую копулу Маршалла-Ол\-ки\-на \cite{marshall1996copulas, Quesada} с коэффициентами $0\leqslant\alpha,\beta\leqslant1$
\begin{equation} \label{eq:copula}
  C_{\alpha,\beta}(u,v)=uv \min {(u^{-\alpha},v^{-\beta} )}.
\end{equation}


Этап предобработки состоит в оценивании плотности распределений случайных величин $X$ и $Y,$ описывающих число детектируемых транспортных средств на полосах 1 и 2 соответственно на основе данных, полученных с оптических детекторов города Красноярска с 2019 по 2020 год. 
На первом шаге строятся ядерные оценки плотности с ядром Епанечникова \cite{Epanechnikov}. Далее формулируется упрощающее предположение о том, что каждая из рассматриваемых случайных величин представима в виде смеси нормальных распределений. 
С использованием EM-алгоритма \cite{EM}, на вход которого продавались значения ядерной оценки плотности, определяются параметры смесей.



Для этапа имитационного моделирования  среднесуточных интенсивностей (generator) была разработана модификация метода дискретной суперпозиции Монте-Карло для  генерации  значений случайной величины $(X,Y)$:
\begin{description}[itemsep=-3pt]
  \item [\sf{этап 1:}] моделируем равномерно распределенные на отрезке $[0;\;1]$ случайные величины ${l}, {w};$
  \item [\sf{этап 2:}] если выполняется $\sum\limits_{m=1}^{M} p_m <{l}< \sum\limits_{m=1}^{M+1}p_m,$ то функция распределения $M$-й компоненты смеси  $F = F_M;$
  \item [\sf{этап 3:}] аналогично этапу 2, для ${w}$ определяем функцию распределения компоненты смеси $G;$
  \item [\sf{этап 4:}] моделируем случайные величины $(U,V)$ согласно~{\cite{nelsen2006introduction}};
  \item [\sf{этап 5:}] восстанавливаем $U$-квантиль $X_U$ распределения $F;$
  \item [\sf{этап 6:}] восстанавливаем $V$-квантиль $Y_V$ распределения $G.$
\end{description}


\begin{example}
  Результаты  этапа предобработки  на 10-й итерации EM алгоритма и вид маргинальных плотностей  распределений случайных величин $X$  и $Y$ приведены на рисунке~\ref{fig:margin}а) и рисунке \ref{fig:margin}б) соответственно.
  \begin{figure}[tbph]
    \centering
    а)\includegraphics[width = 0.35\textwidth, trim={0 1cm 0 3.2cm}, clip]{EM_yad_oc_dens1.png}
    б)\includegraphics[width = 0.35\textwidth, trim={0 1cm 0 3.2cm}, clip]{EM_yad_oc_dens2.png}
    \caption{Результаты этапа предобработки: оценка плотностей маргинальных плотностей: а)случайной величины $X$; б) случайной величины $Y$}\label{fig:margin}
  \end{figure}
  \newpage

  Гистограмма выборки, полученной моделированием копулой Маршалла-Олкина с параметрами \(\alpha=0.9, \beta=0.25\) представлена на рисунке \ref{fig:revive_distrib}.

  \begin{figure}[tbph]
    \centering
    \includegraphics[width = 0.7\textwidth, trim={5.5cm 1cm 2cm 2cm}, clip]{EM_revive_density_function.png}
    \caption{Сравнение эмпирической  $f_{XY}^{*}$  и теоретической $f_{XY}$ функции плотности распределения $(X,Y)$ при моделировании значений $(U, V)$ для  копулы Маршалла-Олкина с параметрами  $\alpha=0.9, \beta=0.25$ }\label{fig:revive_distrib}
  \end{figure}
  
\noindent
\rule{0.95\textwidth}{0em}
\end{example}

\newpage

\section{Модуль адаптивного управления светофорными \\объектами}
\label{par:MARLIN24_comp}





На основании данных, полученных при  наблюдении в модуле симуляции, формируется
двумерная выборка  ${\cal X}=\left\{(s_i, a_i)\right\}_{i=1}^N$
объемом $N$ порядка $10^6$. В результате  управления $\delta^*,$ принятого из соображений увеличения значения функции оценки эффективности (\ref{VALUE}) с учетом выбранной стратегии агентов,  рассчитывается  несмещенная оценка
распределения ${\cal P}=\{p(s, a)\}_{s\in{\state}, a\in{\action}}$ двумерной случайной величины $(s, a)$, где функция распределения
$p(s, a)$  --- вероятность того, что в состоянии $s$ агент принял решение $a$.
На основании
выборочных вероятностей  $\hat{p}(s, a)$ вычисляются оценки
политики агента $\hat{\pi}(a| s)$  для каждого $s\in\state$
$$
  \hat{\pi}(a| s)=\frac{\hat{p}(s, a)}{\displaystyle \sum\limits_{a\in{\mathbb A}}\hat{p}(s,a)}=\frac{\hat{p}(s, a)}{\hat{p}(s)}.
$$
%На практике при решении прямой задачи распределение $\perprob\left(s , a\right)$ неизвестно, но т.к. исследуется выборка объемом порядка $10^6$, то по ней возможно восстановить функцию распределения случайной величины. Согласно закону больших чисел
% (ссылка на справочник большакова  
%оно находится с помощью известной  эмпирической функции распределения $\perprob^*_n\left(s , a\right).$
Наряду с политиками агента, при обработке интенсивностей записываются массивы  $r_{a^{(k)}} =\left\{r(s_0,a^{(k)}),r(s_1,a^{(k)}),r(s_2,a^{(k)}),\dots\right\}$, $ k=0,1$.
Элементы этих массивов $r\left(s_t,a^{(k)}\right)$  вычислены как время нахождения машин на активируемых  фазой  $a^{(k)}\oplus s_t$  полосах. %Отсчет времени начинается с момента обнаружения машины датчиками.
% Результат обработки интенсивности трафика представлен на рисунке \ref{fig:intens1}.
% \red{добавить рисунок}
% \begin{figure}[H]
%     \centering
%     %\includegraphics[width=0.99\textwidth]{exintens.png}
%     \caption{Интенсивность трафика на перекрестке в течение 24 часов, зеленый цвет соответствует фазе $s^{(0)}$, красный --- $s^{(1)}$}
%     \label{fig:intens1}
% \end{figure}
Опишем подробнее процесс подсчета $\hat{\pi}(a| s),$ опираясь на схему на рисунке~\ref{fig:structure_MARLIN24}.




Согласно схеме на рисунке~\ref{fig:structure_MARLIN24}, модуль адаптивного управления светофорными объектами загружает управляющий конфигурационный файл trafficLightConfig.xml. В конфигурационном файле содержится информация о возможных направлениях движения, количестве фаз и циклах светофорных объектов.
Далее разработанный комплекс программных средств MARLIN24  связывает  показания  датчика в имитационном модуле  и рассчитывает оптимальное управление для светофорных объектов.

Пусть оптические датчики (VEHICLE DETECTOR) в имитационной среде (Simulation)  записывают момент появления $t_i$ транспортного средства $i \in I \subset \mathbb{N}$ в зоне $z\in Zones = $ $ = \left\{z^{(0)}, z^{(1)}, \dots, z^{(m)} \right\}, m \in \mathbb{N}$.
Отметим, что при имитационном моделировании   псевдослучайная интенсивность движения транспортных средств будет задана алгоритмически. Это означает, что мы можем сконструировать множество пар $(i,z),$ что  автомобиль $i$ находится в детектируемой зоне $z$ в момент времени $t.$ Определим данное множество как отношение $\psi_t \subset \mathbb{N} \times Zones, $ для которого  $i\psi_t z.$
Введем также отношение $\phi \subset Zones \times \state,$ описывающее зоны $z, $ в которых состояние $s'$ разрешает движение.
Сгруппируем автомобили в  зонах в соответствии с фазой светофорного объекта $s'$, которая разрешает движение транспортных средств в этих зонах и обозначим
$
  I(s',t) = \left\{i|\;\; t_i < t, i \psi_t z, z \phi s' \right\}.
$
d
Пусть в момент времени $t$  активна фаза светофора  $s\in \state$ и управление $a = \delta(s) \in \action$, задержка на фазе $R= \sum\limits_{i \in I(s',t)} (t -t_i).$

Далее для построенного множества светофорных объектов $TL$  и зон детекции $z$ определяются функция наград $r(s,a) = \mathbb{E} R,$ число проехавших машин (Mcount), суммарное время проезда через детектируемые участки дорожной сети (TIME\_SUMM) и  обучающие функции $Q.$

Схема  подсчета функции оценки эффективности управления управления светофорными объектами
представлена на рисунке~\ref{fig:MARLIN_alg}.
\begin{figure}[tbph]
  \centering
  \includegraphics[width = 0.99\textwidth, trim = 1.51pt 1.51pt 1.51pt 1.51pt, clip]{mod_scheme.pdf}
  \caption{Схема алгоритма MARLIN24 управления светофорными объектами}\label{fig:MARLIN_alg}
\end{figure}


При совокупном управлении светофорными объектами в результате вызова процедуры generator в имитационной среде (Simulation)    создаются машины   в количествах, приближенных к реальным значениям. 
Далее автомобили перемещаются в имитационной среде (Simulation) пока  не выйдут из ее зоны покрытия. При попадании машины на детектируемый участок дорожной сети $z,$ во вспомогательном модуле, 
имитирующем поступление информации с оптических датчиков (VEHICLE DETECTOR), пары, состоящие из указателей на объект машины и текущего времени модели, добавляются в одну из коллекций tcf (time collection forward) 
для выбранного вручную множества светофорных объектов $TL.$ 
На следующем шаге симуляции машины удаляются из коллекции tcf, при проезде через зону $z.$ 
В течении периода времени period во вспомогательном модуле выбора управления (DECISION MODULE) вызывается модуль QLEARNING,
% зачем ссылка на учебники??? \cite{Ivanov,Gasnikov} 
реализующий управление согласно выбранной стратегии совокупного управления. На основе выходных данных модуля принимается решение о переключении фазы светофоров (Next phase). % (см. рис. \ref{MARLIN_mod}).

\section{Вычислительные эксперименты и обсуждение}

\label{par:computation}

Для исследования представленных в работе моделей были проведены серии вычислительных экспериментов. Эксперименты проводились на ПК с процессором Intel Core i7-10510U CPU@1.80ГГц и оперативной памятью объемом 8ГБ.
\begin{figure}[tbph]
  \centering
  а)\includegraphics[width = 0.48\textwidth]{model_ex.pdf}
  б)\includegraphics[width = 0.44\textwidth]{SV-GOD_123.jpg}
  \caption{а)модель рассматриваемого участка дорожной сети, реализованная в системе MARLIN24; б)зоны дороги (жёлтый цвет), фиксируемые оптическими датчиками}
  \label{fig:ex3}
\end{figure}

\newpage
Вычислительный эксперимент состоит в
\begin{itemize}[itemsep=-5pt]
  \item демонстрации сходимости функции оценки эффективности управления $Q$ к $\hat{Q}$ при равновесной по Нэшу стратегии в таблице~\ref{table:strategies};
  \item сравнении графиков кривой обучения $Q^i$ для светофорных объектов $0,1$ при условии ограниченного обзора пространства состояний $\mathcal{O}$ и при условии, когда оно совпадает с полным пространством состояний $\mathbf{\state};$
  \item сравнении показателей эффективности управления для АСУДД24 и MARLIN24.
\end{itemize}

\begin{table}[tbph]\footnotesize
  \caption{Графики кривых обучения}\label{table:strategies}
  \centering
  \begin{tabular}{|p{0.07\textwidth}|l|}\hline
    \rotatebox[origin = c]{90}{\parbox[s]{0.25\textwidth}{\centering $\mathcal{O}\subset \state^0\times\state^1,$                                                                                                                                                   \\ $\mathbf{\state} =  \state^0\times\state^1\times\state^2$}}	& \parbox[s]{0.85\textwidth}{\centering \includegraphics[width = 0.85\textwidth]{learningcurve20.png}\\\includegraphics[width = 0.85\textwidth]{learningcurve21.png}  }\\\hline
    \rotatebox[origin = c]{90}{\parbox[s]{0.3\textwidth}{\centering \rule{0em}{2em}$\mathcal{O} =  \mathbf{\state} = \state^0\times\state^1\times\state^2$}} & \parbox[s]{0.85\textwidth}{\centering \includegraphics[width = 0.85\textwidth]{learningcurve2.png} } \\\hline
  \end{tabular}
\end{table}


Отметим, что при рассмотрении полного пространства состояний, суммарное время нахождения транспортных на участке, принадлежащем второму светофорному объекту, значительно меньше, чем на $0$ и $1$-ом,  и поэтому при машинном обучении время нахождения было усреднено до общего времени и составило 40 секунд. Сравнение комплекса MARLIN24 и АСУДД24 в работе \cite{My9} показало сопоставимые результаты (таблица~\ref{table:compar1}).
\begin{table}[tbph]
  \centering
  \caption{Сравнение показателей эффективности управления для различных моделей}
  \label{table:compar1}
  \scalebox{0.9}{
    \begin{tabular}{|c|c|>{\columncolor{blue!20}}c |>{\columncolor{red!20}}c |  >{\columncolor{sfugrey!20}}c|}
      \hline
      \parbox[s]{6em}{\rule{0em}{1.2em}Целевая функция}                                                   &
      \parbox[t]{2em}{Ед.                                                                                   \\ изм.} &
      \parbox[s]{4em}{\rule{0em}{1.2em}АСУДД24}                                                           &
      \parbox[s]{5em}{\rule{0em}{1.2em}MARLIN24}                                                          &
      \rotatebox[origin=B]{90}{\rule{0.2em}{0em}улучшение\rule{0.2em}{0em}}
      \\
      \hline
      \mbox{\parbox[s][1.2\height]{6em}{\rule{0em}{1.5em}Средняя                                            \\ задержка}}&
      $\frac{\rule[0.2em]{0em}{1.5em}\displaystyle\text{cек.}}{\rule{0em}{1em}\displaystyle\text{маш.}} $ &
      10.63                                                                                               &
      9.4                                                                                                 &
      11.6\%
      \\
      \hline
      \mbox{\parbox[s]{6em}{\rule{0em}{1.5em}Пропускная                                                     \\ способность\rule[-1em]{0em}{1em}}}&
      маш.                                                                                                &
      4 870                                                                                               &
      4 412                                                                                               &
      -9.4\%
      \\
      \hline
      \mbox{\parbox[s][1.2\height]{6em}{\rule{0em}{1.5em}Суммарное                                          \\ время}}&
      сек.                                                                                                &
      51 792                                                                                              &
      41 286                                                                                              &
      20.3\%
      \\
      \hline
    \end{tabular}}
\end{table}
\noindent
В рамках вычислительных экспериментов было проведено сравнение кривых обучения  агентов на протяжении 100 эпох. 
В результате эффективного управления время ожидания транспортного средства в среднем не превышает длины цикла светофорного объекта. 
Также было продемонстрировано, что значительного улучшения управления при расширении покрытия дорожной сети может и не быть. 
Таким образом, координированное управление светофорными объектами в целях ускорения вычислений может быть рассмотрено только в тех участках, где его применение дает ощутимое улучшение в управлении. 
В остальных случаях может быть рассмотрен некоординированный подход, и, следовательно, <<проклятие размерности>>, возникающее с ростом размерности матриц при вычислениях, не является серьезной проблемой.


\newpage
% Авторы - по алфавиту, сначала русскоязычные, затем остальные.
\begin{thebibliography}{10}
\bibitem{transp_strat}
\textit{Транспортная стратегия Российской Федерации, утверждена распоряжением Правительства Российской Федерации от 22 ноября 2008 года №1734-р} [Электронный ресурс].~-- Режим доступа: http://mintrans.gov.ru. -- Дата обращения: 25.06.2024.

\bibitem{ASUDD}
\textit{АСУДД <<МИКРО--М>>} [Электронный ресурс].~-- Режим доступа: http://asud55.ru/archives/1346. -- Дата обращения: 25.06.2024.

\bibitem{Ivanov}
\textit{Иванов, С. Конспект по обучению с подкреплением} [Электронный ресурс].~-- Режим доступа: https://arxiv.org/abs/2201.09746. -- Дата обращения: 25.06.2024.

\bibitem{python-threading}
\textit{threading --- Thread-based parallelism} [Электронный ресурс].~-- Режим доступа: https://docs.python.org/3/library/threading.html. -- Дата обращения: 25.06.2024.

\bibitem{networkx}
\textit{NetworkX} [Электронный ресурс].~-- Режим доступа: https://networkx.org/. -- Дата обращения: 25.06.2024.

\bibitem{MARL}{\MakeUppercase{El-Tantawy, S.}, \MakeUppercase{Abdulhai, B.}} \textit{Towards multi-agent reinforcement learning for integrated network of optimal traffic controllers (MARLIN-OTC)}~// Transportation Letters: The International Journal of Transportation Research.~-- 2010.~-- Т.~2.~-- С.~89--110.

\bibitem{IDM}{\MakeUppercase{Treiber, M.}, \MakeUppercase{Hennecke, A.}, \MakeUppercase{Helbing, D.}} \textit{Congested traffic states in empirical observations and microscopic simulations}~// Transportation Physics Reviews E.~-- 2000.~-- Т.~62.~-- С.~1805--1824.

\bibitem{Quesada}{\MakeUppercase{Quesada-Molina, J.J.}, \MakeUppercase{Rodr?guez-Lallena, J.A.}} \textit{Bivariate copulas with quadratic sections}~// Journal of Nonparametric Statistics.~-- 1995.~-- С.~323--337.

\bibitem{Epanechnikov}{\MakeUppercase{Epanechnikov, V.A.}} \textit{Non-Parametric Estimation of a Multivariate Probability Density}~// Theory of Probability and Its Applications.~-- 1969.~-- С.~153--158.


\bibitem{GASNIKOV}{\MakeUppercase{Гасников, А.В.}, \MakeUppercase{Горбунов, Э.А.} и др.} \textit{Лекции по случайным процессам: учебное пособие.}~-- М.: МФТИ, 2019.~-- 208~с.

\bibitem{EM}{\MakeUppercase{Bishop, C.M.}} \textit{Pattern Recognition and Machine Learning.}~-- Springer, 2007.~-- 738~с.

\bibitem{SHOOT}{\MakeUppercase{Зализняк, В.Е.}} \textit{Численные методы. Основы научных вычислений: учебное пособие для бакалавров.}~-- М.: ЮРАЙТ, 2012.~-- 356~с.

\bibitem{Voitisheck}{\MakeUppercase{Войтишек, А.В.}} \textit{Основы метода Монте-Карло: Учебное пособие.}~-- Новосибирск: НГУ, 2010.~-- 108~с.

\bibitem{MOBIL}{\MakeUppercase{Treiber, M.}, \MakeUppercase{Helbing, D.}} \textit{Realistische Mikrosimulation von Stra?enverkehr mit einem einfachen Modell}~// 16. Symposium "Simulationstechnik ASIM 2002" Rostock.~-- 2002.~-- С.~514--520.

\bibitem{My2}{\MakeUppercase{Tislenko~T.I., Semenova~D.V., Sergeeva~N.A., Goldenok~E.E., Kononova~N.V.}} \textit{Multiagent Reinforcement Learning for Integrated Network: Applying to a Part of the Road Network of Krasnoyarsk City}~// IEEE 16th International Conference on Application of Information and Communication Technologies (AICT).~-- 2022.~-- С.~1--5.

\bibitem{My3}{\MakeUppercase{Tislenko~T.I., Semenova~D.V., Soldatenko~A.A.}} \textit{Modeling and Comparison of Different Management Approaches on the Intersections Network}~// 2023 IEEE 26th International Conference, Distributed Computer and Communication Networks: Control, Computation, Communications (DCCN).~-- 2023.~-- С.~25--29.

\bibitem{My9}{\MakeUppercase{Тисленко~Т.И.}} \textit{О двух подходах адаптивного управления светофорными объектами участка дорожной сети г. Красноярска}~// Информационные технологии и математическое моделирование (ИТММ-2023): Материалы XXII Международной конференции имени А.Ф. Терпугова.~-- Томск: Национальный исследовательский Томский государственный университет, 2023.~-- С.~273--278.

\bibitem{OMSK}{\MakeUppercase{Тисленко~Т.И.}} \textit{Моделирование интенсивностей транспортных потоков при помощи копул Маршала-Олкина}~// ИТ. НАУКА. КРЕАТИВ. Т. 5. Системы управления, информационные технологии и математическое моделирование: материалы I Междунар. форума (Омск, 14–16 мая 2024 г.) : в 5 Ч. / науч. ред. П. С. Ложников, отв. ред. И. Г. Ольгина.~-- Омск: Издательство ОмГТУ, 2024.~-- 70~с.

\bibitem{TOMSK}{\MakeUppercase{XXXX}} \textit{xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx}~// XXXXXXXXXXXXXXXX.~-- 21.10.03.~-- .

\bibitem{nelsen2006introduction}{\MakeUppercase{Nelsen~R.B.}} \textit{An Introduction to Copulas}~-- New York: Springer, 2006.~-- 270~p.

\bibitem{marshall1996copulas}{\MakeUppercase{Marshall~A.}} \textit{Copulas, Marginals, and Joint Distributions}~// Lecture Notes-Monograph Series. Distributions with Fixed Marginals and Related Topics.~-- 1996.~-- No.~28.~-- С.~213--222.


\bibitem{first}
  {\MakeUppercase{Адорно~Т.В.}} \textit{К логике социальных наук}~// Вопросы философии.~-- 1992.~-- №10.~-- С.~76--86.

  \bibitem{second}
  {\MakeUppercase{Большов~П.П.}} \textit{Название книги}.~-- М.: Изд-во <<УБС>>, 2017.~-- 142~c.


  \bibitem{r4}{\MakeUppercase{Глухов~В.А.}} \textit{Исследование, разработка и построение системы электронной доставки документов в библиотеке}: Автореф. дис. канд. техн. наук. – Новосибирск, 2000. – 18 с.

  \bibitem{r5}{\MakeUppercase{Еськов~Д.Н., Бонштедт~Б.Э., Корешев~С.Н., Лебедева~Г.И., Серегин~А.Г.}} \textit{Оптико-электронный аппарат}~// Патент России №2122745.~-- 1998.~-- Бюл.~№33.

  \bibitem{r6}{\MakeUppercase{Корнилов В.И.}} \textit{Турбулентный пограничный слой на теле вращения при периодическом вдуве/отсосе}~// Теплофизика и аэромеханика.~-- 2006.~-- Т.~13, №3.~-- С.~369--385.

  \bibitem{r7}{\MakeUppercase{Кузнецов~А.Ю.}} \textit{Консорциум -- механизм организации подписки на электронные ресурсы}~// Российский фонд фундаментальных исследований: десять лет служения российской науке.~-- М.: Научный мир, 2003.~-- С.~340--342.

  \bibitem{r8}{\MakeUppercase{Литчфорд~Е.У.}} \textit{С Белой Армией по Сибири} [Электронный ресурс]~// Восточный фронт Армии Генерала А.В.~Колчака: сайт.~-- URL: http://east-front.narod.ru/memo/latchford.htm (дата обращения: 23.08.2007).

  \bibitem{r9}{\MakeUppercase{Логинова~Л.Г.}} \textit{Сущность результата дополнительного образования детей}~// Образование: исследовано в мире: междунар. науч. пед. интернет-журн.~-- 21.10.03.~-- URL: http://www.oim.ru/reader.asp?nomer=366 (дата обращения: 17.04.07).

  \bibitem{r10}\textit{Официальные периодические издания : электронный путеводитель}~/ Рос. нац. б-ка, Центр правовой информации. [СПб.], 2005--2007.~-- URL:  http://www.nlr.ru/lawcenter/ izd/index.html (дата обращения: 18.01.2007).

  \bibitem{r11}Патент РФ №2000130511/28, 04.12.2000.

  \bibitem{r12}{\MakeUppercase{Райзберг~Б.А.,  Лозовский~Л.Ш., Стародубцева~Е.Б.}} \textit{Современный экономический словарь.} 5-е изд., перераб. и доп.~-- М.:ИНФРА-М, 2006.~-- 494~с.

  \bibitem{r13}\textit{Рынок тренингов Новосибирска: своя игра} [Электронный ресурс].~-- Режим доступа: http://nsk.adme.ru/news/2006/07/ 03/2121.html.

  \bibitem{r14}{\MakeUppercase{Тарасова~В.И.}} \textit{Политическая история Латинской Америки}: учеб. для вузов. 2-е изд.~-- М.: Проспект, 2006.~-- С.~305--412.

  \bibitem{r15}{\MakeUppercase{Фенухин В. И.}} \textit{Этнополитические конфликты в современной России: на примере Северо-Кавказского региона}: дис. канд. полит. наук.~-- М., 2002.~-- С.~54--55.

  \bibitem{r16}\textit{Философия культуры и философия науки: проблемы и гипотезы}: межвуз. сб. науч. тр. / Сарат. гос. ун-т; [под ред. С.Ф.~Мартыновича].~-- Саратов: Изд-во Сарат. ун-та, 1999.~-- 199~с.

  \bibitem{r17}\textit{Экономика и политика России и государств ближнего зарубежья}: аналит. обзор, апр. 2007 / Рос. акад. наук, Ин-т мировой экономики и междунар. отношений.~-- М.: ИМЭМО, 2007.~-- 39~с.

  \bibitem{r18}{\MakeUppercase{Crawford~P.J.,  Barrett~T.P.}} \textit{The reference librarian and the business professor: a strategic alliance that works}~// Ref. Libr.~-- 1997.~-- Vol.~3, No.~58.~-- P.~75--85.

  \bibitem{r19}http://www.nlr.ru/index.html (дата обращения: 20.02.2007).

\end{thebibliography}
\newpage
\makeenginfo
\makeauxinfo

\end{document}
