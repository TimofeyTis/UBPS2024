%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Sample document for preparing papers for  "Upravlenie bolshimi sistemami"
%%  charset=windows-1251
%%  The sample is based on the analogous sample of "Avtomatika i Telemekhanika".
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[11pt]{ubs}
%%
%% для просмотра "as is" необходим набор русских шрифтов А. Лебедева
%% http://tex.imm.uran.ru/texserver/fonts/pscyr/pscyr4c/
%%

%_______________________________________________________________________________________________________
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{diagbox}
\usepackage{multirow}
\usepackage{empheq}
\usepackage{colortbl}
\usepackage{xcolor} % Для задания цветов
\DeclareMathOperator{\perprob}{P}
\DeclareMathOperator{\state}{\mathcal{S}}
\DeclareMathOperator{\action}{\mathcal{A}}

\definecolor{sfugrey}{RGB}{56,79,123}
%_______________________________________________________________________________________________________

\issue{XX}% Выпуск Сборника - проставляется в процессе верстки
\rubric{Программы и системы моделирования объектов, средств и систем управления}%  Рубрика Сборника - может быть скорректирована редактором
%
% Имеющиеся рубрики (последнюю информацию см. на сайте ubs.mtas.ru):
%
%    Системный анализ
%    Математическая теория управления
%    Анализ и синтез систем управления
%    Информационные технологии в управлении
%    Управление в социально-экономических системах
%    Управление в медико-биологических и экологических системах
%    Управление техническими системами и технологическими процессами
%    Управление подвижными объектами и навигация
%    Технические и программные средства управления
%    Надежность и диагностика средств и систем управления
%    Программы и системы моделирования объектов, средств и систем управления

% В соответствии с требованиями ВАК коды УДК и ББК обязательны. Проставляются автором. Могут быть скорректированы редактором
\udk{УДК ...} % Коды УДК можно найти на сайте https://classinform.ru/udk.html
\bbk{ББК ...} % Коды ББК можно найти на сайте https://classinform.ru/bbk.html

\title{Разработка адаптивной системы управления светофорными объектами с использованием марковских процессов принятия решений}% Название статьи
\engtitle{Article Title} % В соответствии с требованиями ВАК обязательно указывается название статьи на английском языке.

% Ссылка на грант и прочие благодарности. Оставьте команду \footnote и просто измените ее аргумент.
% Если ссылка не нужна, просто удалите следующую строку.
\thanks{\footnote{Работа поддержана Красноярским математическим центром, финансируемым Минобрнауки РФ (Соглашение 075-02-2024-1429).}}

% Список авторов должен вводиться в представленной форме. Авторы вводятся в алфавитном порядке.
% Сначала указывается Фамилия И.О., затем следует подстрочная ссылка (footnote) с полным именем,
% ученой степенью, должностью и контактной информацией (телефоном или e-mail-ом) автора,
% затем, с новой строки курсивом - организация, в которой работает автор.
% Если несколько подряд идущих авторов работают в одной организации, допускается перечислять их в одной строке,
% после которой идет строка с названием организации (см. пример ниже).
%
\authors{
%
\textbf{Тисленко~Т.И.}\footnote{Тисленко Тимофей Иванович, \emph{(}timtisko@mail.ru\emph{)}.},
\textbf{Семенова~Д.В.}\footnote{Семенова Дарья Владиславовна,\,д.ф.-м.н.,\,доцент\,\hbox{\makebox(25ex,1ex){\;\;\;\emph{(}DVSemenova@sfu-kras.ru\emph{).}
}
} }\\
\textit{\emph{(}Сибирский федеральный университет, г.~Красноярск\emph{)}}
%
}
%
\engauthors{% % В соответствии с требованиями ВАК обязательно указывается информация об авторах на английском языке.
\textbf{Alexander Ivanov}, Institute of Control Sciences of RAS,
Moscow, Cand.Sc., assistant professor (aaivanov@mail.ru). \\
\textbf{Boris Petrov}, Institute of Control Sciences of RAS, Moscow,
Doctor of Science, professor (Moscow, Profsoyuznaya st., 65,
(495)000-00-00). \\
\textbf{Vikor Sidorov}, Moscow Institute of Physics and Technology,
Moscow, student (viktor.sidorov@mipt.ru). }

\abstract{%
В статье представлены результаты разработки программного комплекса MARLIN24, предназначенного для адаптивного управления светофорными \linebreak объектами. 
Структура комплекса включает  модуль адаптивного управления светофорными объектами, модуль симуляции движения транспорта и  модуль валидации. 
Математическая модель процесса управления светофорными \linebreak объектами --- управляемый марковский процесс с конечным числом действий и \linebreak  состояний. Задача поиска эффективного управления в целях  уменьшения суммарного времени нахождения  транспортных средств на детектируемых участках дорожной сети  сводится к задаче мультиагентного обучения с подкреплением (Multiagent Reinforcement Learning for Integrated Network, MARLIN).  Для поиска решения задачи MARLIN был построен алгоритм \linebreak $Q$-обучения.  
Структура комплекса программных средств также включает модуль  микросимуляции транспортных потоков  <<разумный водитель>> (Intelligent Driver Model, IDM).
Для имитации информации о реальной дорожной обстановке, поступающей в виде показаний оптического датчика,  в модуле валидации используются многомерные распределения, полученные с помощью применения копул Маршала-Олкина к маргинальным эмпирических распределениям для временных отметок  срабатывания оптического датчика.
Для построения маргинальных распределений использовались данные об интенсивности движения через детектируемые участки дорожной сети в период с 2019 по 2020 год.
}

% В соответствии с требованиями ВАК обязательно приводится расширенная аннотация на английском языке.
% Объем расширенной английской аннотации -- 150-200 слов.
% Английский текст проверяется редактором на предмет грамотности и соответствия русскому тексту и может быть изменен без согласования с авторами статьи.
\engabstract{%
% 150--200 words. Describes the standards of articles' formatting for "Large systems control" papers collection. Provides the examples for typical elements of an article. 150--200 words. Describes the standards of articles' formatting for "Large systems control" papers collection. Provides the examples for typical elements of an article. 150--200 words. Describes the standards of articles' formatting for "Large systems control" papers collection. Provides the examples for typical elements of an article. 150--200 words. Describes the standards of articles' formatting for "Large systems control" papers collection. Provides the examples for typical elements of an article.\newpage
}

% Обязательно указывается от трёх до шести ключевых слов
\keywords{
  имитационное моделирование транспортных потоков, модель IDM, модель MOBIL, копулы Маршалла-Олкина, машинное обучение с подкреплением
  }

% В соответствии с требованиями ВАК обязательно приводится перевод ключевых слов на английский язык.
\engkeywords{
  % large systems control, electronic scientific publication, article formatting template
}

\presented{...}% Член редколлегии, представляющий статью к публикации, заполняется редактором
\received{...}% Дата получения материала редакционной коллегией, заполняется  редактором
\published{...}% Дата опубликования статьи, заполняется редактором

\begin{document}

\maketitle

\section{Введение}
Одной из задач решаемых в ходе реализации транспортной стратегии России на 2035 год \cite{transp_strat} является увеличение пропускной способности и увеличение скоростных параметров дорожной инфраструктуры до уровня лучших мировых достижений.
Разработка и внедрение программных и математических инструментов для моделирования транспортных потоков и управления
светофорными объектами для наиболее нагруженных участков дорожной сети учитывает общесоциальные целевые ориентиры транспортной стратегии: подвижность населения, снижение аварийности, рисков и угроз безопасности по видам транспорта, снижение доли транспорта в загрязнении окружающей среды. Одним из подходов к решению поставленных задач является использование продвинутых систем, управляющих светофорными объектами.
% Системы, управляющие светофорными объектами, подразделяют на те, которые корректируют сигналы светофоров в реальном времени и реагируют на текущую дорожную обстановку --- АСУД (адаптивные системы управления дорожным движением) и неадаптивные --- те, которые работают согласно фиксированному плану управления.
% Неадаптивные системы светофоров  переключают фазы светофоров через заранее заданное фиксированное время.
В таблице \ref{tab:adapt} представлены наиболее известные АСУД (адаптивные системы управления дорожным движением).
\begin{table}[h!]
  \caption{Модели адаптивных систем светофоров}
  \label{tab:adapt}
  \centering
  \scalebox{0.65}{
    \begin{tabular}{|c||c|c|c|c|c|c|}\hline
      \textbf{Критерий} & \textbf{UTCS-1}                       & \textbf{SCOOT}                          & \textbf{OPAC}                                                 & \textbf{MARLIN} & \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}\textbf{АСУДД} \\\textbf{<<Микро>>}\rule[-0.5em]{0em}{1.2em}} \\ \hline
      город             & Вашингтон                             & Лондон                                  & \parbox{0.2\textwidth}{\centering \rule{0em}{1.2em}Арлингтон,                                                                                    \\Тускон\rule[-0.5em]{0em}{1.2em}} & Торонто & Красноярск \\ \hline
      \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}временной                                                                                                                                                                                            \\период} &1970е&1995&1983,1989& 2010 & 1993\\ \hline
      \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}длительность                                                                                                                                                                                         \\фаз\rule[-0.5em]{0em}{1.2em}} & \multicolumn{2}{c|}{фиксированная}  & \multicolumn{3}{c|}{переменная}  \\ \hline
      оптимизация       & офлайн                                & \multicolumn{4}{c|}{онлайн}                                                                                                                                                                \\ \hline
      предсказание      & нет                                   & \multicolumn{2}{c|}{есть}               & нет                                                           & есть                                                                             \\ \hline
      устройство        & \multicolumn{2}{c|}{централизованная} & \multicolumn{3}{c|}{децентрализованная}                                                                                                                                                    \\ \hline
      \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}основные                                                                                                                                                                                             \\ограничения\rule[-0.5em]{0em}{1.2em}}   & \parbox{0.2\textwidth}{\centering\rule{0em}{1.2em}постоянный\\сбор данных} & \parbox{0.15\textwidth}{\centering \rule{0em}{1.2em}сенсоры \\далеко} & \parbox{0.2\textwidth}{\centering \rule{0em}{1.2em}только для\\  8 фаз}& \parbox{0.25\textwidth}{\centering <<ПРОКЛЯТИЕ\\РАЗМЕРНОСТИ>>} &  \parbox{0.2\textwidth}{\centering \rule{0em}{1.2em}находится \\в разработке} \\ \hline
      работы, авторы &&&&&\\\hline
    \end{tabular}
  }
\end{table}

Приведённые  адаптивных систем светофоров были разработаны в различные временные периоды и для различных условий движения.
Например, система SCOOT (Split Cycle Offset Optimization Technique) анализирует данные о дорожной обстановке и корректирует светофорные сигналы, чтобы предотвратить образование заторов до их появления. Для работы данной системы требуется установка плотной сети индукционных петель, камер и других датчиков движения на расстоянии около сорока метров от регулируемых перекрёстков. Централизованное управление SCOOT направлено на устранение «эффекта волны» \cite{}. Однако продолжительность каждого сигнала светофора (Split) не указывает на изменение времени активной фазы в реальном времени.

Система OPAC (Optimized Policies for Adaptive Control) — это адаптивная система управления светофорами, схожая по назначению с системой SCOOT, но использующая другой подход для оптимизации транспортных потоков. OPAC, разработанная в США, предназначена для улучшения дорожной ситуации в реальном времени путем адаптации фаз светофоров в зависимости от условий трафика. В системе OPAC существует ограничение в восемь фаз для каждого светофора. Это ограничение связано с практическими соображениями, поскольку каждая фаза представляет собой отдельное направление движения или определённую комбинацию разрешённых манёвров на перекрёстке (например, движение прямо, поворот налево или направо). Эти ограничения заложены аппаратно, то есть на уровне контроллеров, и не могут быть изменены конечным пользователем.

Автоматизированная система управления дорожным движением (АСУДД) «Микро» \cite{ASUDD} — наиболее широко используемая в России система, успешно применяемая в следующих регионах: Иркутск, Красноярский край, Иркутская область, Красноярск, Белгород, Ангарск, Воронеж, Хабаровск, Московская область. АСУДД «Микро» является децентрализованной системой и поддерживает до шести GPRS-серверов, которые позволяют подключить 250 перекрёстков. Отечественные оптические детекторы серии «Инфопро», используемые в АСУДД «Микро», предназначены для сбора статистических данных о транспортном потоке и данных реального времени для актуального управления; они работают на расстоянии до 100 метров. По дальности распознавания данные датчики не уступают их бельгийскому аналогу TrafiCam. Основным недостатком системы является тот факт, что реализация адаптивных алгоритмов  находится в стадии разработки.

В данной работе предложен программный комплекс MARLIN24, реализующий часть методов новейших АСУД, использующих метод мультиагентного обучения с подкреплением (Multiagent Reinforcement Learning for Integrated Network, MARLIN) \cite{MARL}. Целью обучения с подкреплением является сокращение времени проезда транспортных средств через выбранные участки дорожной сети. Управление светофорными объектами считается эффективным, если транспортные средства находятся на детектируемых участках менее двух циклов.
К достоинствам подхода на основе MARLIN можно отнести следующие положения. Для работы требуется установка камер на расстоянии менее ста метров от стоп-линий. Агенты (светофоры) могут работать без информации о полной дорожной обстановке и управлять движением децентрализованно. Существенным ограничением является рост вычислительной сложности при увеличении обзора агента, известный как «проклятие размерности».
Структура комплекса программных средств MARLIN24 приведена на рисунке~\ref{fig:structure_MARLIN24}.
\begin{figure}[tbph]
  \centering
  \includegraphics[width=0.99\textwidth]{structure}
  \caption{Структура комплекса программных средств MARLIN24}\label{fig:structure_MARLIN24}
\end{figure}


% Как альтернатива к применяемым на практике АСУД, в работе  предложен метод адаптивного управления, использующий  мультиагентное обучение с подкреплением (Multiagent Reinforcement Learning for Integrated Network, MARLIN)\cite{MARL}, основанные на марковских процессах принятия решений, которые могут и не оперировать интенсивностью проезда через поперечное сечение дороги.



% Во {введении }  дается краткий обзор наиболее известных систем адаптивного управления светофорными объектами. Приводятся особенности реализации.


В {параграфе \ref{par:MARL_description}} приведено описание задачи машинного обучения с подкреплением для одного агента.
Агент (светофорный объект) не располагает ресурсами и решает задачу целесообразности активации той или иной светофорной фазы. Обозначим множество всех действий агента символом $\action$. Среда --- детектируемый перекресток с  оптическими датчиками, которые распознают машины на отрезках дорог за сто метров до стоп-линий. Состояние среды отражает активность фазы светофорных объектов и время, которое машины находятся в детектируемой зоне. Обозначим множество всех состояний среды символом $\state$.
В качестве математической модели светофорного объекта в работе рассматривается управляемый марковский процесс с конечным числом действий и  состояний $\left\langle  \state, \action, \mathbb{P}, r \right\rangle.$
Проблема управления 
светофорными объектами сводится к задаче мультиагентного обучения с подкреплением (Multiagent Reinforcement Learning).

В {параграфе \ref{par:MARL_many_description}} приведено описание задачи машинного обучения с подкреплением для нескольких агентов.
Введены основные определения и обозначения  для задачи обучения нескольких агентов. 
Задача поиска управления одного агента сведена к задаче машинного обучения нескольких агентов.

В {параграфе \ref{par:MARL_solution}} приведено решение задачи машинного обучения с подкреплением для нескольких агентов.
Приведены критерий оптимального управления Вальда-Беллмана в предложении \ref{prep:kropt}, итерационная запись для функции оценки эффективности управления $V,$ а также приведено предложение \ref{prep:search} о существовании и единственности оптимального решения.
В параграфе \ref{par:MARL_solution} выведены формулы для поиска оптимального решения (\ref{Voptsolve}) и (\ref{argoptsolve}).


% Для исследования задачи управления светофорными объектами был разработан комплекс программных средств MARLIN24.
% В {параграфах \ref{par:MARLIN24_sim}, \ref{par:MARLIN24_val}, \ref{par:MARLIN24_comp}} приведено описание модулей комплекса программных средств MARLIN24.


В  {параграфе \ref{par:computation}} были проведены вычислительные эксперименты для реального участка дорожной сети, построены кривые обучения функции оценки эффективности управления и дана интерпретация оптимальному управлению.


\input{simulation.tex}

\input{validation.tex}

\input{adapt.tex}


\input{calc.tex}


% \section{Описание задачи для одного агента}
% \label{par:MARL_description}


% Как правило, обучение с подкреплением используется для одного агента в среде, чтобы максимизировать его долгосрочную награду. В работе исследуется модель обучения с подкреплением нескольких агентов (светофорных объектов) в стохастической среде. Обучение с подкреплением сводится к оптимальному сопоставлению агентом действия $a$ состоянию среды $s$. Предложенная математическая модель процесса выбора фазы светофора учитывает текущее расположение светофоров и их загрузку и позволяет сформулировать оптимизационные задачи, целью которых является минимизация задержки движения автомобилей. Отметим, что структура мультиагентной системы обеспечивает наиболее эффективное распараллеливание всей задачи на подзадачи.

% Введём следующие обозначения: $ \state$ --- дискретное пространство состояний, $ \action$ --- дискретное пространство действий агента, $\delta \colon \state\to \action$ --- управление сменой фаз светофора. Фазы светофора меняются последовательно. Полагаем, что множество $ \state$ есть кольцо классов вычетов по модулю $n$ --- $\mathbb{Z}_n = \left\langle \mathbb{Z}, +, \cdot\right\rangle$, где $| \state| = n$ --- количество классов $\mathbb{Z}_n$.


% Характеристика кольца вычетов $\mathbb{Z}_n$ равна $n$ и в данной модели отражает число смен фазы светофора до её возвращения к начальному значению, следовательно, число действий $\left|\action\right|$ до возвращения в начальное состояние светофора равно $n$.

% Если агент находится в состоянии $s$, то при выборе действия $a = \delta(s)$ новое состояние $s'$ определяется формулой
% {
% \abovedisplayskip=0pt plus 0pt
% \begin{equation}
%   s'=(a\oplus s) = (a+s)\;\mathrm{mod}\;{\left\lvert\state \right\rvert}.
%   \label{eq:newstate}
% \end{equation}}





% Элементы матрицы переходов между состояниями $\mathbb{P}$ определяются вероятностями вида  $p(s' \bigm| s,a), $ где $s$ --- текущее состояние среды, $a$ --- текущее действие среды,  $s'$ --- следующее состояние среды и определяется по формуле (\ref{eq:newstate}). 
% Состояние $s'$ всецело определяется текущим состоянием $s$ и выбранным действием $a.$


% Под отложенным до момента времени $t$ вознаграждением принято понимать число $\gamma^t r_t.$ Далее предел в выражении (\ref{VALUE}) будем опускать.
% %  Предпочтительным управлением  $\delta$ будет то, значение целевой функции $V(\delta)$ для которого будет больше. 


% Формальная постановка  задачи вычисления оценки эффективности управления светофорным объектом представлена ниже.
% \begin{center}
%   \begin{tabular}{rl}
%     {\sf Дано}:
%      &
%     \parbox[t]{0.84\textwidth}{марковский процесс принятия решения $\left\langle  \state, \action, \mathbb{P}, r \right\rangle$ для  управления светофорным объектом, активная  в начальный момент времени фаза светофорного объекта $s_0$.}
%     \\
%     {\sf  Найти}:
%      &
%     \parbox[t]{0.84\textwidth}{
%     управление  светофорного  объекта $\delta^*=\{ a^*_t\}_{0\leq t<\infty}$,\;\;\;\;  которое  доставит максимум функции оценки его\;\;\;\;\;\;\;\;  эффективности (\ref{VALUE}).
%     }
%   \end{tabular}
% \end{center}


% \section{Описание задачи для нескольких агентов}
% \label{par:MARL_many_description}




% Расширим  задачу  на сеть из $K$ светофорных объектов. Утверждения сформулированные выше   справедливы для $K$ агентов. Далее для удобства записи будем использовать множество из двух агентов.   
% Имеем множество из двух агентов, для каждого из которых описаны множество состояний $ \state^0, \state^1$ и множество решений $\action^0, \action^1$. 
% Обозначим $\textbf{s}_t = \{s_t^1, s_t^2\} \in \state^0\times \state^1$ как  совокупное состояние среды в момент времени $t$,    $\textbf{a}_t = \{a_t^0, a_t^1\} \in \action^0\times \action^1$ как совокупное управление в момент времени $t$.

% Отметим, что смена фазы любым агентом приводит к изменению общего состояния среды $\textbf{s}$.
% \begin{example}
%   В таблице \ref{table:raspred2} представлен пример распределения условных вероятностей перехода из состояния $\textbf{s}$ в состояние $\textbf{s}'$ с учетом выбора действия $\textbf{a}$.

%   \begin{table}[tbh]
%     \centering
%     \caption{Распределение $p(\textbf{s}' \bigm| \textbf{s}, \textbf{a})$ }
%     \label{table:raspred2}
%     \scalebox{0.63}{
%       \begin{tabular}{|*6{c|}}
%         \hline
%         $\textbf{a}$                        & \diagbox[width=3em, height=3em]{\hspace{0.5em}$\textbf{s}$}{\hspace{2ex}\raisebox{-0.6em}{$\textbf{s}'$}} & $\textbf{s}^{(0)}$ & $\textbf{s}^{(1)}$ & $\textbf{s}^{(2)}$ & $\textbf{s}^{(3)}$ \\
%         \hline\hline
%         \multirow{4}{*}{$\textbf{a}^{(0)}$} & $\textbf{s}^{(0)}$                                                                                        & 1                  & 0                  & 0                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(1)}$                                                                                        & 0                  & 1                  & 0                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(2)}$                                                                                        & 0                  & 0                  & 1                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(3)}$                                                                                        & 0                  & 0                  & 0                  & 1                  \\
%         \hline\hline
%         \multirow{4}{*}{$\textbf{a}^{(1)}$} & $\textbf{s}^{(0)}$                                                                                        & 0                  & 1                  & 0                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(1)}$                                                                                        & 0                  & 0                  & 1                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(2)}$                                                                                        & 0                  & 0                  & 0                  & 1                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(3)}$                                                                                        & 1                  & 0                  & 0                  & 0                  \\
%         \hline
%       \end{tabular}
%       \begin{tabular}{|*6{c|}}
%         \hline
%         $\textbf{a}$                        & \diagbox[width=3em, height=3em]{\hspace{0.5em}$\textbf{s}$}{\hspace{2ex}\raisebox{-0.6em}{$\textbf{s}'$}} & $\textbf{s}^{(0)}$ & $\textbf{s}^{(1)}$ & $\textbf{s}^{(2)}$ & $\textbf{s}^{(3)}$ \\
%         \hline
%         \hline
%         \multirow{4}{*}{$\textbf{a}^{(2)}$} & $\textbf{s}^{(0)}$                                                                                        & 0                  & 0                  & 1                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(1)}$                                                                                        & 0                  & 0                  & 0                  & 1                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(2)}$                                                                                        & 1                  & 0                  & 0                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(3)}$                                                                                        & 0                  & 1                  & 0                  & 0                  \\
%         \hline\hline
%         \multirow{4}{*}{$\textbf{a}^{(3)}$} & $\textbf{s}^{(0)}$                                                                                        & 0                  & 0                  & 0                  & 1                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(1)}$                                                                                        & 1                  & 0                  & 0                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(2)}$                                                                                        & 0                  & 1                  & 0                  & 0                  \\
%         \cline{2-6}
%                                             & $\textbf{s}^{(3)}$                                                                                        & 0                  & 0                  & 1                  & 0                  \\
%         \hline
%       \end{tabular} }
%   \end{table}
%   \noindent
%   Также переходы между состояниями, соответствующие рассматриваемой цепи, можно графически изобразить в виде стохастического графа на рисунке~\ref{fig:stohgraph22}, где используется нумерация в двоичной системе счисления согласно  формуле (\ref{zeroone}).

%   \begin{figure}[tbph]
%     \centering
%     \includegraphics[width =0.55\textwidth]{stog_graph_4state}
%     \caption{Стохастический граф управляемого процесса смены фаз. Здесь $s_{l}$ отражает совокупное состояние светофоров $l$ ($l = $0b00, 0b01, 0b10, 0b11).  При действии $\textbf{a}^{(m)}$  ($m = $0b00, 0b01, 0b10, 0b11) процесс перейдет в состояние $n = l\oplus m$, c вероятностью $p_{ln}$.}
%     \label{fig:stohgraph22}
%   \end{figure}

% \noindent
% \rule{0.95\textwidth}{0em}
% \end{example}



% Для случая, когда рассматривается сеть светофорных объектов с двумя состояниями, следующую фазу светофора можно найти с помощью операции <<исключающего или>>:
% \begin{equation}\label{zeroone}
%   \textbf{s}'=\textbf{a} \oplus \textbf{s}.
% \end{equation}

% Введем обозначение  двоичного литерала из языка программирования  Python3.
% Согласно ей, в записи перед номером ставится префикс $0b$ (binary). Например, число $2$ в двоичной записи будет представлено как  $0b10$.
% В  случае для действия $\textbf{a}=2$ можно провести следующие рассуждения: с заменой системы счисления и сопоставлением вектору из $\action^0\times \action^1$. Действия $a^0 =1$ и $a^1 =0$  однозначно  задают совместное действие $\textbf{a} = \left(a^0,a^1\right) = 0b10$.


% В момент времени $t$ функция наград $r(\textbf{s}_t,\textbf{a}_t)$ определяется как сумма функций наград каждого агента по отдельности $r(\textbf{s}_t,\textbf{a}_t) = r(s_t^0,a_t^0) + r(s_t^1,a_t^1),$ которые в свою очередь рассчитываются согласно формуле (\ref{VALUE}).
% В таком случае функция оценки эффективности управления примет вид
% \begin{equation}\label{VALUE3}
%   \displaystyle V(\textbf{s}) =  \sum\limits_{t=0}^{\infty}\gamma^t r(\textbf{s}_t,\textbf{a}_t),
% \end{equation}
% где $0 \leq \gamma \leq 1$ --- коэффициент переоценки.

% Управление фазами двух светофорных объектов находится как решение задачи обучения с подкреплением (Multiagent Reinforcement Learning for   Integrated Network, MARLIN) и формулируется следующим образом.
% \begin{center}
%   \begin{tabular}{rp{0.85\textwidth}}
%     {\sf Дано}:
%      &
%     \parbox[t]{0.85\textwidth}{марковский процесс принятия решения
%       $\left\langle  \state^0\times \state^1, \action^0\times \action^1, \mathbb{P}, r \right\rangle$ для управления дорожной сетью из двух светофорных объектов, активные  в начальный момент времени фазы $\textbf{s}_0$.}
%     \\
%     {\sf Найти}:
%      &
%     \parbox[t]{0.85\textwidth}{
%     управление светофорными объектами  $\delta^*=\{ \textbf{a}^*_t\}_{0\leq t<\infty}$, которое доставит максимум функции оценки  эффективности  (\ref{VALUE3}). }
%   \end{tabular}
% \end{center}


% %Требуется найти такое управление $\delta=\{\textbf{a}_t, 0\leq t<\infty\}$, которое доставляет максимум функции суммарных вознаграждений для двух агентов 
% %\begin{equation}\label{VALUEfor2}
% %\displaystyle V(\textbf{s}) =  \mathbb{E}\sum\limits_{t=0}^{\infty}\gamma^t r(\textbf{s}_t,\textbf{a}_t) \rightarrow \max\limits_{\delta},\textbf{s}_0 = \textbf{s},
% %\end{equation}
% \section{Решение задачи}
% \label{par:MARL_solution}


% Перепишем формулу (\ref{BELMAN}) в итерационной записи, называемой $Q$-обучение.
% Функция суммарных вознаграждений при оптимальном управлении на шаге $t$ имеет вид
% {\abovedisplayskip=0.5em
% \belowdisplayskip=0.0em
% \[
%   V^*\left(\{\textbf{s}_{t'}, \delta \}_{t'=0}^{t'=t}\right)=\max\limits_{\textbf{a}\in{\cal \action}} Q_t(\textbf{s}_t, \textbf{a}),
% \]}

% {\abovedisplayskip=-0.5em
% \belowdisplayskip=0.0em
% \[
%   Q_t(\textbf{s}_t, \textbf{a})  =    \sum\limits_{\textbf{s}_{t+}\in {\cal \state}} p(\textbf{s}_{t+1} \bigm|\textbf{s}_t,\textbf{a})\Bigl(r(\textbf{s}_{t+1} \bigm|\textbf{s}_t,\textbf{a})+\gamma \max\limits_{\textbf{a}' \in {\cal \action}}Q_{t-1}(\textbf{s}_{t-1},\textbf{a}') \Bigr).
% \]
% }

% Для совместных действий и состояний итерационно заданная функция $Q_t$ имеет вид:
% {
% \abovedisplayskip=0.5em
% \belowdisplayskip=0.0em
% $$
%   Q_t(\textbf{s},\textbf{a}) = \sum\limits_{\textbf{s}'} p(\textbf{s}'\bigm|\textbf{s}, \textbf{a})r(\textbf{s},\textbf{a}) + \gamma\sum\limits_{\textbf{s}'}p(\textbf{s}' \bigm| \textbf{s}, \textbf{a})
%   V^*\left(\textbf{s}' \right).
% $$}
% \noindent
% Условимся, что записи $Q_t(\textbf{s},a,a')$ и $ Q_t(\textbf{s},\textbf{a})$ тождественны.

% Считаем, что нам известно состояние среды $s_{t+1}$ и оптимальное управление $a_{t+1} $ на шаге $t+1,$ соответствующий итерации ${\hat{t}},$ и условимся, что итерация $Q$ идет по индексу $\hat{t}$, тогда
% {\abovedisplayskip=0.5em
% \begin{equation}\label{eq:iteration_formula_Q}
%   \begin{split}
%     Q_{t}(\textbf{s},\textbf{a}) & =  \underbrace{p(s_{t+1}| s,a)\rule[-0.8em]{0em}{2em}}_{\alpha_{\hat{t}}} \Bigl( r_{t+1} + \gamma V^*(\textbf{s}_{t+1})\Bigr)  +                                                                         \\
%                                  & + \underbrace{\sum\limits_{\textbf{s}' \in S/\textbf{s}_{t+1}} p(\textbf{s}'| \textbf{s},\textbf{a}) }_{1-\alpha_{\hat{t}}}\Bigl( r(\textbf{s}'| \textbf{s},\textbf{a}) + \gamma V(\textbf{s}') \Bigr) = \\
%                                  & =\alpha_{\hat{t}}\Bigl( r_{\hat{t}} + \gamma\max\limits_{\textbf{s}'}Q_{\hat{t}}(\textbf{s}_{t+1},\textbf{s}')\Bigr)  + \Bigl(1- \alpha_{\hat{t}}\Bigr) Q_{\hat{t}}(\textbf{s},\textbf{a})   =           \\
%                                  & =  Q_{\hat{t}+1}(\textbf{s},\textbf{a}).
%   \end{split}
% \end{equation}}

% Сведем задачу поиска максимизирующего совместного действия агентов $k,j$ к случаю для одного агента, совершающего действие $\textbf{a}^{kj}$.  
% Функция $Q$ для агента $k$ определяется как
% \abovedisplayskip=0.5em
% \belowdisplayskip=0.0em
% \begin{equation*}
%   \begin{split}
%     Q_{\hat{t}}^k(\textbf{s},a^k) & = \sum\limits_{a^j \in \action^j} p(a^j \bigm| s, a^k) \Bigl(
%     r(\textbf{s},\textbf{a}^{kj}) +                                                                                                                                                  \\
%                                   & + \gamma\sum\limits_{\textbf{s}'}p\left(\textbf{s},\textbf{a}^{kj}\right)\max\limits_{\textbf{a}'}Q_{\hat{t}-1}(\textbf{s}',\textbf{a}') \Bigr).
%   \end{split}
% \end{equation*}

% Оптимальное управление для фиксированного агента $k$ будем искать как решение задачи MARL в виде %\cite{}:
% {
% \abovedisplayskip=-0em
% \belowdisplayskip=0em
% \begin{equation}\label{eq:solfor2}
%   {a}^k_{\hat{t}} = \arg\max\limits_{{a}^{k} \in  \action^k} Q^k_{\hat{t}}( \textbf{s}_{\hat{t}}, {a}^{k}).
% \end{equation}
% }
% Вероятность $p(a^j \bigm| s, a^k)$ --- это вероятность того, что агент $j$ выберет действие $\textbf{a}^j$ с учётом текущего совместного состояния $\textbf{s}$ и выбранного агентом $k$ действия $\textbf{a}^k$.

% Решение задачи поиска  оптимального совокупного управления светофорными объектами дорожной сети ищется, чтобы увеличить максимальное совокупное вознаграждение, определяемое функцией $Q$ по итерационной формуле (\ref{eq:iteration_formula_Q}),~(\ref{eq:solfor2}). 
% Вероятность  $p\left(\textbf{s}'\bigm| \textbf{s},\textbf{a}^{kj}\right)$ для такого максимизирующего действия оценивается параметром $\alpha.$ 
% Для каждого многомерного решения верны утверждения (\ref{prep:kropt}), (\ref{prep:search}), а также, они верны в случае нескольких координированных агентов.
% Таким образом, задача совокупного управления несколькими агентами сводится к задаче управления одним агентом и  справедливо утверждение об единственности решения.

% \begin{proposition}\label{prep:search}
%   \cite{My3} Для задачи поиска оптимального управления светофорным объектом с любым количеством фаз
%   % \begin{equation}%\label{VALUE}
%   %V(s) = \mathbb{E}\sum_{t=0}^{\infty}\gamma^t r(s_t,\delta(s_t)) \rightarrow\max\limits_\delta, s_0 = s
%   % \end{equation}
%   справедливы следующие  утверждения
%   \begin{itemize}[itemsep=-3pt]
%     \item существует единственное точное решение;
%     \item оценка точности приближенного  решения на $n$-ом шаге итерации
%           {
%           \belowdisplayskip=0em
%           $$
%             \rho(Q_n, Q_0) \leqslant \frac{\gamma ^n \rho(Q_1, Q_0)}{ 1 - \gamma},
%           $$}
%           где $Q_t \in \mathbb{R} _{\infty}^{| \action|+| \state|}$ --- вектора значений $Q(s, a)$ на шаге $t$,\\
%           $\forall q,w \in \mathbb{R} _{\infty}^{| \action|+| \state|}$ определена функция
%           $\rho(q, w) = \max\limits_{ 1\leqslant j \leqslant \left|A\right|+\left|S\right|} \left| {q}_j - {w}_j\right|;$ % --- метрика пространства  $\mathbb{R} _{\infty}^{| \action|+| \state|}$, определенная для $\forall q,w \in \mathbb{R} _{\infty}^{| \action|+| \state|};$
%     \item приближенное решение находится согласно формулам
%           \begin{equation}\label{Voptsolve}
%             V ^*(s) = \max_{a\in  \action}  \lim _{t \to + \infty}Q_t(s, a),     \end{equation}
%           \begin{equation}\label{argoptsolve}
%             a_t(s) = \arg  \max_{a' \in  \action} Q_t(s, a').  \end{equation}



%           %$\left\langle {\mathbb{R} _{\infty}^{| \action|+| \state|},\rho(\cdot, \cdot)} \right\rangle$ --- полное метрическое пространство c 
%           % $\forall q, w \in \mathbb{R} _{\infty}^{| \action|+| \state|}$ 
%           %метрикой $\rho(q, w) = \max\limits_{ 1\leqslant j \leqslant \left|A\right|+\left|S\right|} \left| {q}_j - {w}_j\right|,$ $\forall q, w \in \mathbb{R} _{\infty}^{| \action|+| \state|}.$


%   \end{itemize}
%   %Оценка точности приближенного  решения на $n$-ом шаге итерации имеет вид
%   %  $$
%   % \rho(Q_n(s, a),Q_0(s, a)) \leqslant \frac{\gamma ^n \rho(Q_1(s, a),Q_0(s, a))}{ 1 - \gamma}.
%   % $$
% \end{proposition}



% \newpage


\newpage
% Авторы - по алфавиту, сначала русскоязычные, затем остальные.
\begin{thebibliography}{10}

\end{thebibliography}
\newpage
\makeenginfo
\makeauxinfo

\end{document}
