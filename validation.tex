\section{Модуль валидации}
\label{par:MARLIN24_val}
% \textcolor{red}{пару слов что тут делается}

В модуле валидации  решается задача имитационного моделирования интенсивности движения транспортного потока. В данной работе под интенсивностью транспортного потока будем понимать число автомобилей, проезжающих через поперечное сечение участка дорожной сети в единицу времени.%, а под усредненное интенсивностью --- усредненное количество машин по рабочим дням в течение года.
В модуле предусмотрены два способа подсчета интенсивности: первый способ, учитывающий количество машин  за фиксированный временной интервал  $dt$ \cite{OMSK}, второй --- величину временного интервала между проездом двух автомобилей \cite{TOMSK}.


\subsection{Моделирование интенсивностей транспортных потоков}
\label{subpar:intens model}

На практике оптические датчики закреплены за соответствующей отдельной полосой и движение по полосам, как правило, является зависимым.
Обозначим множество детектируемых участков $Zones, \left\lvert Zones\right\rvert = Z.$
% Следовательно, необходимо учитывать случаи, когда срабатывания датчиков связаны так, что интенсивное движение в полосе одного с большой вероятностью вызывают интенсивное движение для  другого.
% Рассмотрим сечение участка многополосной дороги. 
% В качестве случайной величины будем использовать временной интервал между проездом двух автомобилей через сечение участка в одной полосе.
% Следовательно, для многополосной дороги следует рассматривать систему зависимых случайных величин.  

Пусть случайная величина $X_z$ с функцией распределения $F_z(x)$ есть временной интервал между проездом двух автомобилей через сечение детектируемого участка в зоне $z, z\in Zones.$
Тогда система зависимых случайных величин \((X_1,\dots, X_Z)\) с совместной функцией распределения $H(x_1\dots x_Z)$ описывает интенсивность движения транспортных потоков через детектируемый участок дорожной сети $Zones.$

По теореме Скляра \cite{nelsen2006introduction} совместная функция распределения  представима копулой $C$
\begin{equation}\label{eq:Copula_H}
  H_{X_1\dots X_Z}(x_1,\dots, x_Z)=C(F_1(x_1), \dots,F_Z(x_Z).
\end{equation}
\noindent
Для описания совместного распределения временных интервалов проезда автомобилей будем использовать копулы  Маршал\-ла-Олкина \cite{nelsen2006introduction, COPULAMO} при $0\leqslant\theta_z\leqslant 1,  \widetilde{z} = \argmin(u_1^{-\theta_1}, \dots, u_Z^{-\theta_Z})$
\begin{equation} \label{eq:copula} 
C(u_1,\dots, u_Z; \overline{\theta}) =   u_{\widetilde{z}}^{-\theta_{\widetilde{z}}} \prod_{\mathmakebox[2em][l]{z \in Zones}} u_z.
\end{equation}
\noindent
Для копулы Маршалла-Олкина  совместная плотность $h(x_1,\dots, x_Z)$ при $u_z = F_z(x_z)$ примет следующий вид 
\begin{equation} 
  % \begin{split}
    h(x_1,\dots, x_Z) % &= \frac{\partial^Z H}{\partial x_1\dots\partial x_Z} = \frac{\partial^Z C}{\partial u_1\dots\partial u_Z}  \prod_{\mathmakebox[2em][l]{z \in Zones}} \frac{d F_z (x_z)}{d x_z} =\\
    = (1-\theta_{\widetilde{z}} ) u_{\widetilde{z}}^{-\theta_{\widetilde{z}}}\prod_{\mathmakebox[2em][l]{z \in Zones}} f_{z}(x_z).
  % \end{split}
  \label{eq:new_density}
\end{equation}
\noindent


% Далее для описания совместного распределения интенсивностей движения  на детектируемых полосах будем использовать копулу Маршалла-Ол\-ки\-на \cite{COPULAMO, Quesada} с коэффициентами  $ \ 0\leqslant\theta\leqslant 1, $ 
% {
% % \abovedisplayskip=0em
% % \belowdisplayskip=0.0em
% \begin{equation} \label{eq:copula}
% C(u_1,\dots, u_Z; \overline{\theta}) = \prod_{\mathmakebox[2em][l]{z \in Zones}} u_z^{1-\theta_z} \cdot \min(u_1^{\theta_1}, \dots, u_Z^{\theta_Z}).
% \end{equation}
% }




\subsection{Описание модуля валидации}
\label{subpar: valid desc}
% Под усредненной интенсивностью будем понимать статистический срез по $t$  интенсивности по рабочим дням в течение года.
% Решение задачи моделирования зависимых распределений  среднесуточных интенсивностей на детектируемом участке $Zones$ состоит из двух этапов: этапа  предобработки и этапа имитационного моделирования.
\textcolor{red}{В комплексе  MARLIN24 предусмотрена имитация показаний  оптических датчиков. Она может быть осуществлена с помощью модуля валидации. 
Модуль валидации предназначен для численного моделирования случайных величин, описывающих интенсивность движения транспортных средств.}

Иллюстрация работы оптических датчиков приведена на рисунке~\ref{fig:ex3}а, зоны работы оптических датчиков --- на  рисунке~\ref{fig:ex3}б. 
Опишем совместное распределение интенсивностей движения на примере полос 1 и 2 рисунка \ref{fig:ex3}б. 
Пусть случайная величина $X$ с функцией распределения $F(x)$  описывает длину временного интервала $\Delta t_i$ между проездом автомобилей $i$ и $i+1$ через сечение детектируемого участка на полосах 1. Случайная величина $Y$ с функцией распределения $G (y)$ --- длину временного интервала $\Delta t_j$ на второй полосе соответственно.
Процедура вычисления длин интервалов $\Delta t_i$ следующая.
В таблице фиксируется дискретная временная отметка с частотой обновления детектора 300 секунд, например $t_i.$  Когда транспортное средство $i$ перемещается в зону обзора оптического датчика, счетчик транспортных средств $M$ увеличивается на 1. \textcolor{red}{Длина  временного интервала между проездом двух автомобилей  определяется как $\Delta t_i = \frac{300}{M}$. } Далее аналогично ведется подсчет транспортных средств для отметки  $t_{i+1}= t_i +300.$ 
Упорядоченные по дискретному разбиению $t$ совокупности интервалов $\left\{ (\Delta t_i , \Delta t_j)\right\}$  образуют выборку, которая используется для анализа совместного распределения интенсивности движения на разных полосах.
\begin{figure}[tbph]
    \centering
    \scalebox{0.9}{
        а)\includegraphics[width = 0.45\textwidth]{example_distribution.pdf}
        б)\includegraphics[width = 0.45\textwidth]{SV-LESOP_12.jpg}
    }
    \caption{а)скриншот окна комплекса  MARLIN24; \linebreak б)зоны оптических датчиков (жёлтый цвет) }
    \label{fig:ex3}
\end{figure}

Этап предобработки состоит в оценивании плотности распределений случайных величин $X$ и $Y,$ описывающих число детектируемых транспортных средств на полосах 1 и 2 соответственно на основе данных, полученных с оптических детекторов города Красноярска с 2019 по 2020 год. 
На первом шаге строятся ядерные оценки плотности с ядром Епанечникова \cite{Epanechnikov}. Далее формулируется упрощающее предположение о том, что каждая из рассматриваемых случайных величин представима в виде смеси нормальных распределений. 
С использованием EM-алгоритма \cite{EM}, на вход которого продавались значения ядерной оценки плотности, определяются параметры смесей.
% \begin{description}[itemsep=-3pt]
%   \item [\sf{этап 1:}] моделируем равномерно распределенные на отрезке $[0;\;1]$ случайные величины ${l}, {w};$
%   \item [\sf{этап 2:}] если выполняется $\sum\limits_{m=1}^{M} p_m <{l}< \sum\limits_{m=1}^{M+1}p_m,$ то функция распределения $M$-й компоненты смеси  $F = F_M;$
%   \item [\sf{этап 3:}] аналогично этапу 2, для ${w}$ определяем функцию распределения компоненты смеси $G;$
%   \item [\sf{этап 4:}] моделируем случайные величины $(U,V)$ согласно~{\cite{nelsen2006introduction}};
%   \item [\sf{этап 5:}] восстанавливаем $U$-квантиль $X_U$ распределения $F;$
%   \item [\sf{этап 6:}] восстанавливаем $V$-квантиль $Y_V$ распределения $G.$
% \end{description}
Результаты  этапа предобработки  на 10-й итерации EM алгоритма и вид маргинальных плотностей  распределений случайных величин $X$  и $Y$ приведены на рисунке~\ref{fig:margin}а) и рисунке \ref{fig:margin}б).
\begin{figure}[tbph]
  \centering
  а)\includegraphics[width = 0.4\textwidth]{EM_yad_oc_dens1.png}
  б)\includegraphics[width = 0.4\textwidth]{EM_yad_oc_dens2.png}
  \caption{Результаты этапа предобработки: оценка плотностей маргинальных плотностей: а) $X$; б) $Y$}\label{fig:margin}
\end{figure}


Для этапа имитационного моделирования  среднесуточных интенсивностей была разработана модификация метода дискретной суперпозиции Монте-Карло для  генерации  значений случайной величины $(X,Y)$ \cite{Voitisheck, TOMSK}.

Гистограмма выборки, полученной моделированием копулой Маршалла-Олкина с параметрами  $\overline{\theta}=\left(\frac{9}{10},\frac{1}{4}\right)$  и функция плотности распределения (\ref{eq:new_density}) представлены на рисунке \ref{fig:revive_distrib}.
\begin{figure}[tbph]
  \centering
  \includegraphics[width = 0.65\textwidth, trim={2cm 0.5cm 0.5cm 1.3cm}, clip]{EM_revive_density_function.png}
  \caption{Сравнение эмпирической  $h_{XY}^{*}$ с параметрами  $\overline{\theta}=\left(\frac{9}{10},\frac{1}{4}\right)$  и теоретической $h_{XY}$ функции плотности с.в. $(X,Y)$}\label{fig:revive_distrib}
\end{figure}

Сравнение значений выборки с моделируемыми значениями $(X,Y)$ приведено на рисунке \ref{fig:scatterplot}.
\textcolor{red}{Справа на рисунке \ref{fig:scatterplot} изображены моделируемые временные интервалы, которые используются  при моделировании транспортных потоков, которые участвуют в отладке работы комплекса MARLIN24.}

\begin{figure}[tbph]
  \centering
      \includegraphics[width = 0.43\textwidth]{scatter1.png}
      \includegraphics[width = 0.43\textwidth]{scatterplot.png}
  \caption{Сравнение  моделируемых значений и выборки $(X,Y)$ }
  \label{fig:scatterplot}
\end{figure}

